(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(n){if(n.ep)return;n.ep=!0;const i=t(n);fetch(n.href,i)}})();var Ne,P,Zt,X,Tt,er,et,tr,dt,tt,rt,rr,be={},sr=[],Br=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,ft=Array.isArray;function V(s,e){for(var t in e)s[t]=e[t];return s}function _t(s){s&&s.parentNode&&s.parentNode.removeChild(s)}function nr(s,e,t){var r,n,i,o={};for(i in e)i=="key"?r=e[i]:i=="ref"?n=e[i]:o[i]=e[i];if(arguments.length>2&&(o.children=arguments.length>3?Ne.call(arguments,2):t),typeof s=="function"&&s.defaultProps!=null)for(i in s.defaultProps)o[i]===void 0&&(o[i]=s.defaultProps[i]);return je(s,o,r,n,null)}function je(s,e,t,r,n){var i={type:s,props:e,key:t,ref:r,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:n??++Zt,__i:-1,__u:0};return n==null&&P.vnode!=null&&P.vnode(i),i}function Se(s){return s.children}function Ie(s,e){this.props=s,this.context=e}function ce(s,e){if(e==null)return s.__?ce(s.__,s.__i+1):null;for(var t;e<s.__k.length;e++)if((t=s.__k[e])!=null&&t.__e!=null)return t.__e;return typeof s.type=="function"?ce(s):null}function ir(s){var e,t;if((s=s.__)!=null&&s.__c!=null){for(s.__e=s.__c.base=null,e=0;e<s.__k.length;e++)if((t=s.__k[e])!=null&&t.__e!=null){s.__e=s.__c.base=t.__e;break}return ir(s)}}function st(s){(!s.__d&&(s.__d=!0)&&X.push(s)&&!De.__r++||Tt!==P.debounceRendering)&&((Tt=P.debounceRendering)||er)(De)}function De(){var s,e,t,r,n,i,o,a;for(X.sort(et);s=X.shift();)s.__d&&(e=X.length,r=void 0,i=(n=(t=s).__v).__e,o=[],a=[],t.__P&&((r=V({},n)).__v=n.__v+1,P.vnode&&P.vnode(r),gt(t.__P,r,n,t.__n,t.__P.namespaceURI,32&n.__u?[i]:null,o,i??ce(n),!!(32&n.__u),a),r.__v=n.__v,r.__.__k[r.__i]=r,lr(o,r,a),r.__e!=i&&ir(r)),X.length>e&&X.sort(et));De.__r=0}function or(s,e,t,r,n,i,o,a,l,c,u){var h,d,f,v,y,p,w=r&&r.__k||sr,S=e.length;for(l=qr(t,e,w,l),h=0;h<S;h++)(f=t.__k[h])!=null&&(d=f.__i===-1?be:w[f.__i]||be,f.__i=h,p=gt(s,f,d,n,i,o,a,l,c,u),v=f.__e,f.ref&&d.ref!=f.ref&&(d.ref&&pt(d.ref,null,f),u.push(f.ref,f.__c||v,f)),y==null&&v!=null&&(y=v),4&f.__u||d.__k===f.__k?l=ar(f,l,s):typeof f.type=="function"&&p!==void 0?l=p:v&&(l=v.nextSibling),f.__u&=-7);return t.__e=y,l}function qr(s,e,t,r){var n,i,o,a,l,c=e.length,u=t.length,h=u,d=0;for(s.__k=[],n=0;n<c;n++)(i=e[n])!=null&&typeof i!="boolean"&&typeof i!="function"?(a=n+d,(i=s.__k[n]=typeof i=="string"||typeof i=="number"||typeof i=="bigint"||i.constructor==String?je(null,i,null,null,null):ft(i)?je(Se,{children:i},null,null,null):i.constructor===void 0&&i.__b>0?je(i.type,i.props,i.key,i.ref?i.ref:null,i.__v):i).__=s,i.__b=s.__b+1,o=null,(l=i.__i=Hr(i,t,a,h))!==-1&&(h--,(o=t[l])&&(o.__u|=2)),o==null||o.__v===null?(l==-1&&d--,typeof i.type!="function"&&(i.__u|=4)):l!==a&&(l==a-1?d--:l==a+1?d++:(l>a?d--:d++,i.__u|=4))):i=s.__k[n]=null;if(h)for(n=0;n<u;n++)(o=t[n])!=null&&!(2&o.__u)&&(o.__e==r&&(r=ce(o)),cr(o,o));return r}function ar(s,e,t){var r,n;if(typeof s.type=="function"){for(r=s.__k,n=0;r&&n<r.length;n++)r[n]&&(r[n].__=s,e=ar(r[n],e,t));return e}s.__e!=e&&(e&&s.type&&!t.contains(e)&&(e=ce(s)),t.insertBefore(s.__e,e||null),e=s.__e);do e=e&&e.nextSibling;while(e!=null&&e.nodeType===8);return e}function Hr(s,e,t,r){var n=s.key,i=s.type,o=t-1,a=t+1,l=e[t];if(l===null||l&&n==l.key&&i===l.type&&!(2&l.__u))return t;if((typeof i!="function"||i===Se||n)&&r>(l!=null&&!(2&l.__u)?1:0))for(;o>=0||a<e.length;){if(o>=0){if((l=e[o])&&!(2&l.__u)&&n==l.key&&i===l.type)return o;o--}if(a<e.length){if((l=e[a])&&!(2&l.__u)&&n==l.key&&i===l.type)return a;a++}}return-1}function Et(s,e,t){e[0]==="-"?s.setProperty(e,t??""):s[e]=t==null?"":typeof t!="number"||Br.test(e)?t:t+"px"}function Oe(s,e,t,r,n){var i;e:if(e==="style")if(typeof t=="string")s.style.cssText=t;else{if(typeof r=="string"&&(s.style.cssText=r=""),r)for(e in r)t&&e in t||Et(s.style,e,"");if(t)for(e in t)r&&t[e]===r[e]||Et(s.style,e,t[e])}else if(e[0]==="o"&&e[1]==="n")i=e!==(e=e.replace(tr,"$1")),e=e.toLowerCase()in s||e==="onFocusOut"||e==="onFocusIn"?e.toLowerCase().slice(2):e.slice(2),s.l||(s.l={}),s.l[e+i]=t,t?r?t.u=r.u:(t.u=dt,s.addEventListener(e,i?rt:tt,i)):s.removeEventListener(e,i?rt:tt,i);else{if(n=="http://www.w3.org/2000/svg")e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!="width"&&e!="height"&&e!="href"&&e!="list"&&e!="form"&&e!="tabIndex"&&e!="download"&&e!="rowSpan"&&e!="colSpan"&&e!="role"&&e!="popover"&&e in s)try{s[e]=t??"";break e}catch{}typeof t=="function"||(t==null||t===!1&&e[4]!=="-"?s.removeAttribute(e):s.setAttribute(e,e=="popover"&&t==1?"":t))}}function Pt(s){return function(e){if(this.l){var t=this.l[e.type+s];if(e.t==null)e.t=dt++;else if(e.t<t.u)return;return t(P.event?P.event(e):e)}}}function gt(s,e,t,r,n,i,o,a,l,c){var u,h,d,f,v,y,p,w,S,m,_,b,E,j,B,se,ne,U=e.type;if(e.constructor!==void 0)return null;128&t.__u&&(l=!!(32&t.__u),i=[a=e.__e=t.__e]),(u=P.__b)&&u(e);e:if(typeof U=="function")try{if(w=e.props,S="prototype"in U&&U.prototype.render,m=(u=U.contextType)&&r[u.__c],_=u?m?m.props.value:u.__:r,t.__c?p=(h=e.__c=t.__c).__=h.__E:(S?e.__c=h=new U(w,_):(e.__c=h=new Ie(w,_),h.constructor=U,h.render=Jr),m&&m.sub(h),h.props=w,h.state||(h.state={}),h.context=_,h.__n=r,d=h.__d=!0,h.__h=[],h._sb=[]),S&&h.__s==null&&(h.__s=h.state),S&&U.getDerivedStateFromProps!=null&&(h.__s==h.state&&(h.__s=V({},h.__s)),V(h.__s,U.getDerivedStateFromProps(w,h.__s))),f=h.props,v=h.state,h.__v=e,d)S&&U.getDerivedStateFromProps==null&&h.componentWillMount!=null&&h.componentWillMount(),S&&h.componentDidMount!=null&&h.__h.push(h.componentDidMount);else{if(S&&U.getDerivedStateFromProps==null&&w!==f&&h.componentWillReceiveProps!=null&&h.componentWillReceiveProps(w,_),!h.__e&&(h.shouldComponentUpdate!=null&&h.shouldComponentUpdate(w,h.__s,_)===!1||e.__v===t.__v)){for(e.__v!==t.__v&&(h.props=w,h.state=h.__s,h.__d=!1),e.__e=t.__e,e.__k=t.__k,e.__k.some(function(_e){_e&&(_e.__=e)}),b=0;b<h._sb.length;b++)h.__h.push(h._sb[b]);h._sb=[],h.__h.length&&o.push(h);break e}h.componentWillUpdate!=null&&h.componentWillUpdate(w,h.__s,_),S&&h.componentDidUpdate!=null&&h.__h.push(function(){h.componentDidUpdate(f,v,y)})}if(h.context=_,h.props=w,h.__P=s,h.__e=!1,E=P.__r,j=0,S){for(h.state=h.__s,h.__d=!1,E&&E(e),u=h.render(h.props,h.state,h.context),B=0;B<h._sb.length;B++)h.__h.push(h._sb[B]);h._sb=[]}else do h.__d=!1,E&&E(e),u=h.render(h.props,h.state,h.context),h.state=h.__s;while(h.__d&&++j<25);h.state=h.__s,h.getChildContext!=null&&(r=V(V({},r),h.getChildContext())),S&&!d&&h.getSnapshotBeforeUpdate!=null&&(y=h.getSnapshotBeforeUpdate(f,v)),a=or(s,ft(se=u!=null&&u.type===Se&&u.key==null?u.props.children:u)?se:[se],e,t,r,n,i,o,a,l,c),h.base=e.__e,e.__u&=-161,h.__h.length&&o.push(h),p&&(h.__E=h.__=null)}catch(_e){if(e.__v=null,l||i!=null)if(_e.then){for(e.__u|=l?160:128;a&&a.nodeType===8&&a.nextSibling;)a=a.nextSibling;i[i.indexOf(a)]=null,e.__e=a}else for(ne=i.length;ne--;)_t(i[ne]);else e.__e=t.__e,e.__k=t.__k;P.__e(_e,e,t)}else i==null&&e.__v===t.__v?(e.__k=t.__k,e.__e=t.__e):a=e.__e=zr(t.__e,e,t,r,n,i,o,l,c);return(u=P.diffed)&&u(e),128&e.__u?void 0:a}function lr(s,e,t){for(var r=0;r<t.length;r++)pt(t[r],t[++r],t[++r]);P.__c&&P.__c(e,s),s.some(function(n){try{s=n.__h,n.__h=[],s.some(function(i){i.call(n)})}catch(i){P.__e(i,n.__v)}})}function zr(s,e,t,r,n,i,o,a,l){var c,u,h,d,f,v,y,p=t.props,w=e.props,S=e.type;if(S==="svg"?n="http://www.w3.org/2000/svg":S==="math"?n="http://www.w3.org/1998/Math/MathML":n||(n="http://www.w3.org/1999/xhtml"),i!=null){for(c=0;c<i.length;c++)if((f=i[c])&&"setAttribute"in f==!!S&&(S?f.localName===S:f.nodeType===3)){s=f,i[c]=null;break}}if(s==null){if(S===null)return document.createTextNode(w);s=document.createElementNS(n,S,w.is&&w),a&&(P.__m&&P.__m(e,i),a=!1),i=null}if(S===null)p===w||a&&s.data===w||(s.data=w);else{if(i=i&&Ne.call(s.childNodes),p=t.props||be,!a&&i!=null)for(p={},c=0;c<s.attributes.length;c++)p[(f=s.attributes[c]).name]=f.value;for(c in p)if(f=p[c],c!="children"){if(c=="dangerouslySetInnerHTML")h=f;else if(!(c in w)){if(c=="value"&&"defaultValue"in w||c=="checked"&&"defaultChecked"in w)continue;Oe(s,c,null,f,n)}}for(c in w)f=w[c],c=="children"?d=f:c=="dangerouslySetInnerHTML"?u=f:c=="value"?v=f:c=="checked"?y=f:a&&typeof f!="function"||p[c]===f||Oe(s,c,f,p[c],n);if(u)a||h&&(u.__html===h.__html||u.__html===s.innerHTML)||(s.innerHTML=u.__html),e.__k=[];else if(h&&(s.innerHTML=""),or(s,ft(d)?d:[d],e,t,r,S==="foreignObject"?"http://www.w3.org/1999/xhtml":n,i,o,i?i[0]:t.__k&&ce(t,0),a,l),i!=null)for(c=i.length;c--;)_t(i[c]);a||(c="value",S==="progress"&&v==null?s.removeAttribute("value"):v!==void 0&&(v!==s[c]||S==="progress"&&!v||S==="option"&&v!==p[c])&&Oe(s,c,v,p[c],n),c="checked",y!==void 0&&y!==s[c]&&Oe(s,c,y,p[c],n))}return s}function pt(s,e,t){try{if(typeof s=="function"){var r=typeof s.__u=="function";r&&s.__u(),r&&e==null||(s.__u=s(e))}else s.current=e}catch(n){P.__e(n,t)}}function cr(s,e,t){var r,n;if(P.unmount&&P.unmount(s),(r=s.ref)&&(r.current&&r.current!==s.__e||pt(r,null,e)),(r=s.__c)!=null){if(r.componentWillUnmount)try{r.componentWillUnmount()}catch(i){P.__e(i,e)}r.base=r.__P=null}if(r=s.__k)for(n=0;n<r.length;n++)r[n]&&cr(r[n],e,t||typeof s.type!="function");t||_t(s.__e),s.__c=s.__=s.__e=void 0}function Jr(s,e,t){return this.constructor(s,t)}function ur(s,e,t){var r,n,i,o;e===document&&(e=document.documentElement),P.__&&P.__(s,e),n=(r=typeof t=="function")?null:t&&t.__k||e.__k,i=[],o=[],gt(e,s=(!r&&t||e).__k=nr(Se,null,[s]),n||be,be,e.namespaceURI,!r&&t?[t]:n?null:e.firstChild?Ne.call(e.childNodes):null,i,!r&&t?t:n?n.__e:e.firstChild,r,o),lr(i,s,o)}function hr(s,e){ur(s,e,hr)}function vt(s,e){var t={__c:e="__cC"+rr++,__:s,Consumer:function(r,n){return r.children(n)},Provider:function(r){var n,i;return this.getChildContext||(n=new Set,(i={})[e]=this,this.getChildContext=function(){return i},this.componentWillUnmount=function(){n=null},this.shouldComponentUpdate=function(o){this.props.value!==o.value&&n.forEach(function(a){a.__e=!0,st(a)})},this.sub=function(o){n.add(o);var a=o.componentWillUnmount;o.componentWillUnmount=function(){n&&n.delete(o),a&&a.call(o)}}),r.children}};return t.Provider.__=t.Consumer.contextType=t}Ne=sr.slice,P={__e:function(s,e,t,r){for(var n,i,o;e=e.__;)if((n=e.__c)&&!n.__)try{if((i=n.constructor)&&i.getDerivedStateFromError!=null&&(n.setState(i.getDerivedStateFromError(s)),o=n.__d),n.componentDidCatch!=null&&(n.componentDidCatch(s,r||{}),o=n.__d),o)return n.__E=n}catch(a){s=a}throw s}},Zt=0,Ie.prototype.setState=function(s,e){var t;t=this.__s!=null&&this.__s!==this.state?this.__s:this.__s=V({},this.state),typeof s=="function"&&(s=s(V({},t),this.props)),s&&V(t,s),s!=null&&this.__v&&(e&&this._sb.push(e),st(this))},Ie.prototype.forceUpdate=function(s){this.__v&&(this.__e=!0,s&&this.__h.push(s),st(this))},Ie.prototype.render=Se,X=[],er=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,et=function(s,e){return s.__v.__b-e.__v.__b},De.__r=0,tr=/(PointerCapture)$|Capture$/i,dt=0,tt=Pt(!1),rt=Pt(!0),rr=0;var Wr=0;function g(s,e,t,r,n,i){e||(e={});var o,a,l=e;"ref"in e&&(o=e.ref,delete e.ref);var c={type:s,props:l,key:t,ref:o,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--Wr,__i:-1,__u:0,__source:n,__self:i};if(typeof s=="function"&&(o=s.defaultProps))for(a in o)l[a]===void 0&&(l[a]=o[a]);return P.vnode&&P.vnode(c),c}const Vr="modulepreload",Kr=function(s){return"/krashen-tracker/"+s},Ot={},ue=function(e,t,r){let n=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),a=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));n=Promise.allSettled(t.map(l=>{if(l=Kr(l),l in Ot)return;Ot[l]=!0;const c=l.endsWith(".css"),u=c?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${u}`))return;const h=document.createElement("link");if(h.rel=c?"stylesheet":Vr,c||(h.as="script"),h.crossOrigin="",h.href=l,a&&h.setAttribute("nonce",a),document.head.appendChild(h),c)return new Promise((d,f)=>{h.addEventListener("load",d),h.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${l}`)))})}))}function i(o){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o}return n.then(o=>{for(const a of o||[])a.status==="rejected"&&i(a.reason);return e().catch(i)})};var ee,$,We,$t,Le=0,dr=[],x=P,xt=x.__b,At=x.__r,Ct=x.diffed,jt=x.__c,It=x.unmount,Rt=x.__;function Te(s,e){x.__h&&x.__h($,s,Le||e),Le=0;var t=$.__H||($.__H={__:[],__h:[]});return s>=t.__.length&&t.__.push({}),t.__[s]}function A(s){return Le=1,fr(gr,s)}function fr(s,e,t){var r=Te(ee++,2);if(r.t=s,!r.__c&&(r.__=[gr(void 0,e),function(a){var l=r.__N?r.__N[0]:r.__[0],c=r.t(l,a);l!==c&&(r.__N=[c,r.__[1]],r.__c.setState({}))}],r.__c=$,!$.u)){var n=function(a,l,c){if(!r.__c.__H)return!0;var u=r.__c.__H.__.filter(function(d){return!!d.__c});if(u.every(function(d){return!d.__N}))return!i||i.call(this,a,l,c);var h=r.__c.props!==a;return u.forEach(function(d){if(d.__N){var f=d.__[0];d.__=d.__N,d.__N=void 0,f!==d.__[0]&&(h=!0)}}),i&&i.call(this,a,l,c)||h};$.u=!0;var i=$.shouldComponentUpdate,o=$.componentWillUpdate;$.componentWillUpdate=function(a,l,c){if(this.__e){var u=i;i=void 0,n(a,l,c),i=u}o&&o.call(this,a,l,c)},$.shouldComponentUpdate=n}return r.__N||r.__}function K(s,e){var t=Te(ee++,3);!x.__s&&yt(t.__H,e)&&(t.__=s,t.i=e,$.__H.__h.push(t))}function Gr(s,e){var t=Te(ee++,4);!x.__s&&yt(t.__H,e)&&(t.__=s,t.i=e,$.__h.push(t))}function Dt(s){return Le=5,_r(function(){return{current:s}},[])}function _r(s,e){var t=Te(ee++,7);return yt(t.__H,e)&&(t.__=s(),t.__H=e,t.__h=s),t.__}function Yr(s){var e=$.context[s.__c],t=Te(ee++,9);return t.c=s,e?(t.__==null&&(t.__=!0,e.sub($)),e.props.value):s.__}function Qr(){for(var s;s=dr.shift();)if(s.__P&&s.__H)try{s.__H.__h.forEach(Re),s.__H.__h.forEach(nt),s.__H.__h=[]}catch(e){s.__H.__h=[],x.__e(e,s.__v)}}x.__b=function(s){$=null,xt&&xt(s)},x.__=function(s,e){s&&e.__k&&e.__k.__m&&(s.__m=e.__k.__m),Rt&&Rt(s,e)},x.__r=function(s){At&&At(s),ee=0;var e=($=s.__c).__H;e&&(We===$?(e.__h=[],$.__h=[],e.__.forEach(function(t){t.__N&&(t.__=t.__N),t.i=t.__N=void 0})):(e.__h.forEach(Re),e.__h.forEach(nt),e.__h=[],ee=0)),We=$},x.diffed=function(s){Ct&&Ct(s);var e=s.__c;e&&e.__H&&(e.__H.__h.length&&(dr.push(e)!==1&&$t===x.requestAnimationFrame||(($t=x.requestAnimationFrame)||Xr)(Qr)),e.__H.__.forEach(function(t){t.i&&(t.__H=t.i),t.i=void 0})),We=$=null},x.__c=function(s,e){e.some(function(t){try{t.__h.forEach(Re),t.__h=t.__h.filter(function(r){return!r.__||nt(r)})}catch(r){e.some(function(n){n.__h&&(n.__h=[])}),e=[],x.__e(r,t.__v)}}),jt&&jt(s,e)},x.unmount=function(s){It&&It(s);var e,t=s.__c;t&&t.__H&&(t.__H.__.forEach(function(r){try{Re(r)}catch(n){e=n}}),t.__H=void 0,e&&x.__e(e,t.__v))};var Lt=typeof requestAnimationFrame=="function";function Xr(s){var e,t=function(){clearTimeout(r),Lt&&cancelAnimationFrame(e),setTimeout(s)},r=setTimeout(t,100);Lt&&(e=requestAnimationFrame(t))}function Re(s){var e=$,t=s.__c;typeof t=="function"&&(s.__c=void 0,t()),$=e}function nt(s){var e=$;s.__c=s.__(),$=e}function yt(s,e){return!s||s.length!==e.length||e.some(function(t,r){return t!==s[r]})}function gr(s,e){return typeof e=="function"?e(s):e}let Y,ve;const Zr=(s,e)=>{if(Y=void 0,e&&e.type==="click"){if(e.ctrlKey||e.metaKey||e.altKey||e.shiftKey||e.button!==0)return s;const t=e.target.closest("a[href]"),r=t&&t.getAttribute("href");if(!t||t.origin!=location.origin||/^#/.test(r)||!/^(_?self)?$/i.test(t.target)||ve&&(typeof ve=="string"?!r.startsWith(ve):!ve.test(r)))return s;Y=!0,e.preventDefault(),e=t.href.replace(location.origin,"")}else typeof e=="string"?Y=!0:e&&e.url?(Y=!e.replace,e=e.url):e=location.pathname+location.search;return Y===!0?history.pushState(null,"",e):Y===!1&&history.replaceState(null,"",e),e};function pr(s){const[e,t]=fr(Zr,s.url||location.pathname+location.search);s.scope&&(ve=s.scope);const r=Y===!0,n=_r(()=>{const i=new URL(e,location.origin),o=i.pathname.replace(/\/+$/g,"")||"/";return{url:e,path:o,query:Object.fromEntries(i.searchParams),route:(a,l)=>t({url:a,replace:l}),wasPush:r}},[e]);return Gr(()=>(addEventListener("click",t),addEventListener("popstate",t),()=>{removeEventListener("click",t),removeEventListener("popstate",t)}),[]),nr(pr.ctx.Provider,{value:n},s.children)}Promise.resolve();pr.ctx=vt({});vt({});const Ut=P.__e;P.__e=(s,e,t)=>{if(s&&s.then){let r=e;for(;r=r.__;)if(r.__c&&r.__c.__c)return e.__e==null&&(e.__e=t.__e,e.__k=t.__k),e.__k||(e.__k=[]),r.__c.__c(s,e)}Ut&&Ut(s,e,t)};let Nt;function es(s,e){if(typeof window>"u")return;let t=document.querySelector("script[type=isodata]");e=e||t&&t.parentNode||document.body,!Nt&&t?hr(s,e):ur(s,e),Nt=!0}const ts=s=>{let e;return s?e=s:typeof fetch>"u"?e=(...t)=>ue(async()=>{const{default:r}=await Promise.resolve().then(()=>de);return{default:r}},void 0).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)};class mt extends Error{constructor(e,t="FunctionsError",r){super(e),this.name=t,this.context=r}}class rs extends mt{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class ss extends mt{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class ns extends mt{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var it;(function(s){s.Any="any",s.ApNortheast1="ap-northeast-1",s.ApNortheast2="ap-northeast-2",s.ApSouth1="ap-south-1",s.ApSoutheast1="ap-southeast-1",s.ApSoutheast2="ap-southeast-2",s.CaCentral1="ca-central-1",s.EuCentral1="eu-central-1",s.EuWest1="eu-west-1",s.EuWest2="eu-west-2",s.EuWest3="eu-west-3",s.SaEast1="sa-east-1",s.UsEast1="us-east-1",s.UsWest1="us-west-1",s.UsWest2="us-west-2"})(it||(it={}));var is=function(s,e,t,r){function n(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(u){try{c(r.next(u))}catch(h){o(h)}}function l(u){try{c(r.throw(u))}catch(h){o(h)}}function c(u){u.done?i(u.value):n(u.value).then(a,l)}c((r=r.apply(s,e||[])).next())})};class os{constructor(e,{headers:t={},customFetch:r,region:n=it.Any}={}){this.url=e,this.headers=t,this.region=n,this.fetch=ts(r)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var r;return is(this,void 0,void 0,function*(){try{const{headers:n,method:i,body:o}=t;let a={},{region:l}=t;l||(l=this.region),l&&l!=="any"&&(a["x-region"]=l);let c;o&&(n&&!Object.prototype.hasOwnProperty.call(n,"Content-Type")||!n)&&(typeof Blob<"u"&&o instanceof Blob||o instanceof ArrayBuffer?(a["Content-Type"]="application/octet-stream",c=o):typeof o=="string"?(a["Content-Type"]="text/plain",c=o):typeof FormData<"u"&&o instanceof FormData?c=o:(a["Content-Type"]="application/json",c=JSON.stringify(o)));const u=yield this.fetch(`${this.url}/${e}`,{method:i||"POST",headers:Object.assign(Object.assign(Object.assign({},a),this.headers),n),body:c}).catch(v=>{throw new rs(v)}),h=u.headers.get("x-relay-error");if(h&&h==="true")throw new ss(u);if(!u.ok)throw new ns(u);let d=((r=u.headers.get("Content-Type"))!==null&&r!==void 0?r:"text/plain").split(";")[0].trim(),f;return d==="application/json"?f=yield u.json():d==="application/octet-stream"?f=yield u.blob():d==="text/event-stream"?f=u:d==="multipart/form-data"?f=yield u.formData():f=yield u.text(),{data:f,error:null}}catch(n){return{data:null,error:n}}})}}var N=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function pi(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}function as(s){if(s.__esModule)return s;var e=s.default;if(typeof e=="function"){var t=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(s).forEach(function(r){var n=Object.getOwnPropertyDescriptor(s,r);Object.defineProperty(t,r,n.get?n:{enumerable:!0,get:function(){return s[r]}})}),t}var D={},wt={},Me={},Ee={},Fe={},Be={},ls=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},he=ls();const cs=he.fetch,vr=he.fetch.bind(he),yr=he.Headers,us=he.Request,hs=he.Response,de=Object.freeze(Object.defineProperty({__proto__:null,Headers:yr,Request:us,Response:hs,default:vr,fetch:cs},Symbol.toStringTag,{value:"Module"})),ds=as(de);var qe={};Object.defineProperty(qe,"__esModule",{value:!0});class fs extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}}qe.default=fs;var mr=N&&N.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(Be,"__esModule",{value:!0});const _s=mr(ds),gs=mr(qe);let ps=class{constructor(e){this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=e.headers,this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=e.shouldThrowOnError,this.signal=e.signal,this.isMaybeSingle=e.isMaybeSingle,e.fetch?this.fetch=e.fetch:typeof fetch>"u"?this.fetch=_s.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=Object.assign({},this.headers),this.headers[e]=t,this}then(e,t){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const r=this.fetch;let n=r(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async i=>{var o,a,l;let c=null,u=null,h=null,d=i.status,f=i.statusText;if(i.ok){if(this.method!=="HEAD"){const w=await i.text();w===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?u=w:u=JSON.parse(w))}const y=(o=this.headers.Prefer)===null||o===void 0?void 0:o.match(/count=(exact|planned|estimated)/),p=(a=i.headers.get("content-range"))===null||a===void 0?void 0:a.split("/");y&&p&&p.length>1&&(h=parseInt(p[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(u)&&(u.length>1?(c={code:"PGRST116",details:`Results contain ${u.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},u=null,h=null,d=406,f="Not Acceptable"):u.length===1?u=u[0]:u=null)}else{const y=await i.text();try{c=JSON.parse(y),Array.isArray(c)&&i.status===404&&(u=[],c=null,d=200,f="OK")}catch{i.status===404&&y===""?(d=204,f="No Content"):c={message:y}}if(c&&this.isMaybeSingle&&(!((l=c==null?void 0:c.details)===null||l===void 0)&&l.includes("0 rows"))&&(c=null,d=200,f="OK"),c&&this.shouldThrowOnError)throw new gs.default(c)}return{error:c,data:u,count:h,status:d,statusText:f}});return this.shouldThrowOnError||(n=n.catch(i=>{var o,a,l;return{error:{message:`${(o=i==null?void 0:i.name)!==null&&o!==void 0?o:"FetchError"}: ${i==null?void 0:i.message}`,details:`${(a=i==null?void 0:i.stack)!==null&&a!==void 0?a:""}`,hint:"",code:`${(l=i==null?void 0:i.code)!==null&&l!==void 0?l:""}`},data:null,count:null,status:0,statusText:""}})),n.then(e,t)}};Be.default=ps;var vs=N&&N.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(Fe,"__esModule",{value:!0});const ys=vs(Be);let ms=class extends ys.default{select(e){let t=!1;const r=(e??"*").split("").map(n=>/\s/.test(n)&&!t?"":(n==='"'&&(t=!t),n)).join("");return this.url.searchParams.set("select",r),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(e,{ascending:t=!0,nullsFirst:r,foreignTable:n,referencedTable:i=n}={}){const o=i?`${i}.order`:"order",a=this.url.searchParams.get(o);return this.url.searchParams.set(o,`${a?`${a},`:""}${e}.${t?"asc":"desc"}${r===void 0?"":r?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t,referencedTable:r=t}={}){const n=typeof r>"u"?"limit":`${r}.limit`;return this.url.searchParams.set(n,`${e}`),this}range(e,t,{foreignTable:r,referencedTable:n=r}={}){const i=typeof n>"u"?"offset":`${n}.offset`,o=typeof n>"u"?"limit":`${n}.limit`;return this.url.searchParams.set(i,`${e}`),this.url.searchParams.set(o,`${t-e+1}`),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:e=!1,verbose:t=!1,settings:r=!1,buffers:n=!1,wal:i=!1,format:o="text"}={}){var a;const l=[e?"analyze":null,t?"verbose":null,r?"settings":null,n?"buffers":null,i?"wal":null].filter(Boolean).join("|"),c=(a=this.headers.Accept)!==null&&a!==void 0?a:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${o}; for="${c}"; options=${l};`,o==="json"?this:this}rollback(){var e;return((e=this.headers.Prefer)!==null&&e!==void 0?e:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}};Fe.default=ms;var ws=N&&N.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(Ee,"__esModule",{value:!0});const bs=ws(Fe);let ks=class extends bs.default{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}in(e,t){const r=Array.from(new Set(t)).map(n=>typeof n=="string"&&new RegExp("[,()]").test(n)?`"${n}"`:`${n}`).join(",");return this.url.searchParams.append(e,`in.(${r})`),this}contains(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return typeof t=="string"?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:r,type:n}={}){let i="";n==="plain"?i="pl":n==="phrase"?i="ph":n==="websearch"&&(i="w");const o=r===void 0?"":`(${r})`;return this.url.searchParams.append(e,`${i}fts${o}.${t}`),this}match(e){return Object.entries(e).forEach(([t,r])=>{this.url.searchParams.append(t,`eq.${r}`)}),this}not(e,t,r){return this.url.searchParams.append(e,`not.${t}.${r}`),this}or(e,{foreignTable:t,referencedTable:r=t}={}){const n=r?`${r}.or`:"or";return this.url.searchParams.append(n,`(${e})`),this}filter(e,t,r){return this.url.searchParams.append(e,`${t}.${r}`),this}};Ee.default=ks;var Ss=N&&N.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(Me,"__esModule",{value:!0});const ge=Ss(Ee);let Ts=class{constructor(e,{headers:t={},schema:r,fetch:n}){this.url=e,this.headers=t,this.schema=r,this.fetch=n}select(e,{head:t=!1,count:r}={}){const n=t?"HEAD":"GET";let i=!1;const o=(e??"*").split("").map(a=>/\s/.test(a)&&!i?"":(a==='"'&&(i=!i),a)).join("");return this.url.searchParams.set("select",o),r&&(this.headers.Prefer=`count=${r}`),new ge.default({method:n,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(e,{count:t,defaultToNull:r=!0}={}){const n="POST",i=[];if(this.headers.Prefer&&i.push(this.headers.Prefer),t&&i.push(`count=${t}`),r||i.push("missing=default"),this.headers.Prefer=i.join(","),Array.isArray(e)){const o=e.reduce((a,l)=>a.concat(Object.keys(l)),[]);if(o.length>0){const a=[...new Set(o)].map(l=>`"${l}"`);this.url.searchParams.set("columns",a.join(","))}}return new ge.default({method:n,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}upsert(e,{onConflict:t,ignoreDuplicates:r=!1,count:n,defaultToNull:i=!0}={}){const o="POST",a=[`resolution=${r?"ignore":"merge"}-duplicates`];if(t!==void 0&&this.url.searchParams.set("on_conflict",t),this.headers.Prefer&&a.push(this.headers.Prefer),n&&a.push(`count=${n}`),i||a.push("missing=default"),this.headers.Prefer=a.join(","),Array.isArray(e)){const l=e.reduce((c,u)=>c.concat(Object.keys(u)),[]);if(l.length>0){const c=[...new Set(l)].map(u=>`"${u}"`);this.url.searchParams.set("columns",c.join(","))}}return new ge.default({method:o,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}update(e,{count:t}={}){const r="PATCH",n=[];return this.headers.Prefer&&n.push(this.headers.Prefer),t&&n.push(`count=${t}`),this.headers.Prefer=n.join(","),new ge.default({method:r,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}delete({count:e}={}){const t="DELETE",r=[];return e&&r.push(`count=${e}`),this.headers.Prefer&&r.unshift(this.headers.Prefer),this.headers.Prefer=r.join(","),new ge.default({method:t,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}};Me.default=Ts;var He={},ze={};Object.defineProperty(ze,"__esModule",{value:!0});ze.version=void 0;ze.version="0.0.0-automated";Object.defineProperty(He,"__esModule",{value:!0});He.DEFAULT_HEADERS=void 0;const Es=ze;He.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${Es.version}`};var wr=N&&N.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(wt,"__esModule",{value:!0});const Ps=wr(Me),Os=wr(Ee),$s=He;let xs=class br{constructor(e,{headers:t={},schema:r,fetch:n}={}){this.url=e,this.headers=Object.assign(Object.assign({},$s.DEFAULT_HEADERS),t),this.schemaName=r,this.fetch=n}from(e){const t=new URL(`${this.url}/${e}`);return new Ps.default(t,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new br(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,t={},{head:r=!1,get:n=!1,count:i}={}){let o;const a=new URL(`${this.url}/rpc/${e}`);let l;r||n?(o=r?"HEAD":"GET",Object.entries(t).filter(([u,h])=>h!==void 0).map(([u,h])=>[u,Array.isArray(h)?`{${h.join(",")}}`:`${h}`]).forEach(([u,h])=>{a.searchParams.append(u,h)})):(o="POST",l=t);const c=Object.assign({},this.headers);return i&&(c.Prefer=`count=${i}`),new Os.default({method:o,url:a,headers:c,schema:this.schemaName,body:l,fetch:this.fetch,allowEmpty:!1})}};wt.default=xs;var fe=N&&N.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(D,"__esModule",{value:!0});D.PostgrestError=D.PostgrestBuilder=D.PostgrestTransformBuilder=D.PostgrestFilterBuilder=D.PostgrestQueryBuilder=D.PostgrestClient=void 0;const kr=fe(wt);D.PostgrestClient=kr.default;const Sr=fe(Me);D.PostgrestQueryBuilder=Sr.default;const Tr=fe(Ee);D.PostgrestFilterBuilder=Tr.default;const Er=fe(Fe);D.PostgrestTransformBuilder=Er.default;const Pr=fe(Be);D.PostgrestBuilder=Pr.default;const Or=fe(qe);D.PostgrestError=Or.default;var As=D.default={PostgrestClient:kr.default,PostgrestQueryBuilder:Sr.default,PostgrestFilterBuilder:Tr.default,PostgrestTransformBuilder:Er.default,PostgrestBuilder:Pr.default,PostgrestError:Or.default};const{PostgrestClient:Cs,PostgrestQueryBuilder:bi,PostgrestFilterBuilder:ki,PostgrestTransformBuilder:Si,PostgrestBuilder:Ti}=As,js="2.11.2",Is={"X-Client-Info":`realtime-js/${js}`},Rs="1.0.0",$r=1e4,Ds=1e3;var le;(function(s){s[s.connecting=0]="connecting",s[s.open=1]="open",s[s.closing=2]="closing",s[s.closed=3]="closed"})(le||(le={}));var L;(function(s){s.closed="closed",s.errored="errored",s.joined="joined",s.joining="joining",s.leaving="leaving"})(L||(L={}));var F;(function(s){s.close="phx_close",s.error="phx_error",s.join="phx_join",s.reply="phx_reply",s.leave="phx_leave",s.access_token="access_token"})(F||(F={}));var ot;(function(s){s.websocket="websocket"})(ot||(ot={}));var Z;(function(s){s.Connecting="connecting",s.Open="open",s.Closing="closing",s.Closed="closed"})(Z||(Z={}));class Ls{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),r=new TextDecoder;return this._decodeBroadcast(e,t,r)}_decodeBroadcast(e,t,r){const n=t.getUint8(1),i=t.getUint8(2);let o=this.HEADER_LENGTH+2;const a=r.decode(e.slice(o,o+n));o=o+n;const l=r.decode(e.slice(o,o+i));o=o+i;const c=JSON.parse(r.decode(e.slice(o,e.byteLength)));return{ref:null,topic:a,event:l,payload:c}}}class xr{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var O;(function(s){s.abstime="abstime",s.bool="bool",s.date="date",s.daterange="daterange",s.float4="float4",s.float8="float8",s.int2="int2",s.int4="int4",s.int4range="int4range",s.int8="int8",s.int8range="int8range",s.json="json",s.jsonb="jsonb",s.money="money",s.numeric="numeric",s.oid="oid",s.reltime="reltime",s.text="text",s.time="time",s.timestamp="timestamp",s.timestamptz="timestamptz",s.timetz="timetz",s.tsrange="tsrange",s.tstzrange="tstzrange"})(O||(O={}));const Mt=(s,e,t={})=>{var r;const n=(r=t.skipTypes)!==null&&r!==void 0?r:[];return Object.keys(e).reduce((i,o)=>(i[o]=Us(o,s,e,n),i),{})},Us=(s,e,t,r)=>{const n=e.find(a=>a.name===s),i=n==null?void 0:n.type,o=t[s];return i&&!r.includes(i)?Ar(i,o):at(o)},Ar=(s,e)=>{if(s.charAt(0)==="_"){const t=s.slice(1,s.length);return Bs(e,t)}switch(s){case O.bool:return Ns(e);case O.float4:case O.float8:case O.int2:case O.int4:case O.int8:case O.numeric:case O.oid:return Ms(e);case O.json:case O.jsonb:return Fs(e);case O.timestamp:return qs(e);case O.abstime:case O.date:case O.daterange:case O.int4range:case O.int8range:case O.money:case O.reltime:case O.text:case O.time:case O.timestamptz:case O.timetz:case O.tsrange:case O.tstzrange:return at(e);default:return at(e)}},at=s=>s,Ns=s=>{switch(s){case"t":return!0;case"f":return!1;default:return s}},Ms=s=>{if(typeof s=="string"){const e=parseFloat(s);if(!Number.isNaN(e))return e}return s},Fs=s=>{if(typeof s=="string")try{return JSON.parse(s)}catch(e){return console.log(`JSON parse error: ${e}`),s}return s},Bs=(s,e)=>{if(typeof s!="string")return s;const t=s.length-1,r=s[t];if(s[0]==="{"&&r==="}"){let i;const o=s.slice(1,t);try{i=JSON.parse("["+o+"]")}catch{i=o?o.split(","):[]}return i.map(a=>Ar(e,a))}return s},qs=s=>typeof s=="string"?s.replace(" ","T"):s,Cr=s=>{let e=s;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")};class Ve{constructor(e,t,r={},n=$r){this.channel=e,this.event=t,this.payload=r,this.timeout=n,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var r;return this._hasReceived(e)&&t((r=this.receivedResp)===null||r===void 0?void 0:r.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(r=>r.status===e).forEach(r=>r.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var Ft;(function(s){s.SYNC="sync",s.JOIN="join",s.LEAVE="leave"})(Ft||(Ft={}));class me{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=(t==null?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},n=>{const{onJoin:i,onLeave:o,onSync:a}=this.caller;this.joinRef=this.channel._joinRef(),this.state=me.syncState(this.state,n,i,o),this.pendingDiffs.forEach(l=>{this.state=me.syncDiff(this.state,l,i,o)}),this.pendingDiffs=[],a()}),this.channel._on(r.diff,{},n=>{const{onJoin:i,onLeave:o,onSync:a}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(n):(this.state=me.syncDiff(this.state,n,i,o),a())}),this.onJoin((n,i,o)=>{this.channel._trigger("presence",{event:"join",key:n,currentPresences:i,newPresences:o})}),this.onLeave((n,i,o)=>{this.channel._trigger("presence",{event:"leave",key:n,currentPresences:i,leftPresences:o})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,r,n){const i=this.cloneDeep(e),o=this.transformState(t),a={},l={};return this.map(i,(c,u)=>{o[c]||(l[c]=u)}),this.map(o,(c,u)=>{const h=i[c];if(h){const d=u.map(p=>p.presence_ref),f=h.map(p=>p.presence_ref),v=u.filter(p=>f.indexOf(p.presence_ref)<0),y=h.filter(p=>d.indexOf(p.presence_ref)<0);v.length>0&&(a[c]=v),y.length>0&&(l[c]=y)}else a[c]=u}),this.syncDiff(i,{joins:a,leaves:l},r,n)}static syncDiff(e,t,r,n){const{joins:i,leaves:o}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return r||(r=()=>{}),n||(n=()=>{}),this.map(i,(a,l)=>{var c;const u=(c=e[a])!==null&&c!==void 0?c:[];if(e[a]=this.cloneDeep(l),u.length>0){const h=e[a].map(f=>f.presence_ref),d=u.filter(f=>h.indexOf(f.presence_ref)<0);e[a].unshift(...d)}r(a,u,l)}),this.map(o,(a,l)=>{let c=e[a];if(!c)return;const u=l.map(h=>h.presence_ref);c=c.filter(h=>u.indexOf(h.presence_ref)<0),e[a]=c,n(a,c,l),c.length===0&&delete e[a]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(r=>t(r,e[r]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,r)=>{const n=e[r];return"metas"in n?t[r]=n.metas.map(i=>(i.presence_ref=i.phx_ref,delete i.phx_ref,delete i.phx_ref_prev,i)):t[r]=n,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var Bt;(function(s){s.ALL="*",s.INSERT="INSERT",s.UPDATE="UPDATE",s.DELETE="DELETE"})(Bt||(Bt={}));var qt;(function(s){s.BROADCAST="broadcast",s.PRESENCE="presence",s.POSTGRES_CHANGES="postgres_changes",s.SYSTEM="system"})(qt||(qt={}));var q;(function(s){s.SUBSCRIBED="SUBSCRIBED",s.TIMED_OUT="TIMED_OUT",s.CLOSED="CLOSED",s.CHANNEL_ERROR="CHANNEL_ERROR"})(q||(q={}));class bt{constructor(e,t={config:{}},r){this.topic=e,this.params=t,this.socket=r,this.bindings={},this.state=L.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new Ve(this,F.join,this.params,this.timeout),this.rejoinTimer=new xr(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=L.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(n=>n.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=L.closed,this.socket._remove(this)}),this._onError(n=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,n),this.state=L.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=L.errored,this.rejoinTimer.scheduleTimeout())}),this._on(F.reply,{},(n,i)=>{this._trigger(this._replyEventName(i),n)}),this.presence=new me(this),this.broadcastEndpointURL=Cr(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(e,t=this.timeout){var r,n;if(this.socket.isConnected()||this.socket.connect(),this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{const{config:{broadcast:i,presence:o,private:a}}=this.params;this._onError(u=>e==null?void 0:e(q.CHANNEL_ERROR,u)),this._onClose(()=>e==null?void 0:e(q.CLOSED));const l={},c={broadcast:i,presence:o,postgres_changes:(n=(r=this.bindings.postgres_changes)===null||r===void 0?void 0:r.map(u=>u.filter))!==null&&n!==void 0?n:[],private:a};this.socket.accessTokenValue&&(l.access_token=this.socket.accessTokenValue),this.updateJoinPayload(Object.assign({config:c},l)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:u})=>{var h;if(this.socket.setAuth(),u===void 0){e==null||e(q.SUBSCRIBED);return}else{const d=this.bindings.postgres_changes,f=(h=d==null?void 0:d.length)!==null&&h!==void 0?h:0,v=[];for(let y=0;y<f;y++){const p=d[y],{filter:{event:w,schema:S,table:m,filter:_}}=p,b=u&&u[y];if(b&&b.event===w&&b.schema===S&&b.table===m&&b.filter===_)v.push(Object.assign(Object.assign({},p),{id:b.id}));else{this.unsubscribe(),e==null||e(q.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=v,e&&e(q.SUBSCRIBED);return}}).receive("error",u=>{e==null||e(q.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(u).join(", ")||"error")))}).receive("timeout",()=>{e==null||e(q.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,r){return this._on(e,t,r)}async send(e,t={}){var r,n;if(!this._canPush()&&e.type==="broadcast"){const{event:i,payload:o}=e,l={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:o,private:this.private}]})};try{const c=await this._fetchWithTimeout(this.broadcastEndpointURL,l,(r=t.timeout)!==null&&r!==void 0?r:this.timeout);return await((n=c.body)===null||n===void 0?void 0:n.cancel()),c.ok?"ok":"error"}catch(c){return c.name==="AbortError"?"timed out":"error"}}else return new Promise(i=>{var o,a,l;const c=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((l=(a=(o=this.params)===null||o===void 0?void 0:o.config)===null||a===void 0?void 0:a.broadcast)===null||l===void 0)&&l.ack)&&i("ok"),c.receive("ok",()=>i("ok")),c.receive("error",()=>i("error")),c.receive("timeout",()=>i("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=L.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(F.close,"leave",this._joinRef())};return this.rejoinTimer.reset(),this.joinPush.destroy(),new Promise(r=>{const n=new Ve(this,F.leave,{},e);n.receive("ok",()=>{t(),r("ok")}).receive("timeout",()=>{t(),r("timed out")}).receive("error",()=>{r("error")}),n.send(),this._canPush()||n.trigger("ok",{})})}async _fetchWithTimeout(e,t,r){const n=new AbortController,i=setTimeout(()=>n.abort(),r),o=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:n.signal}));return clearTimeout(i),o}_push(e,t,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let n=new Ve(this,e,t,r);return this._canPush()?n.send():(n.startTimeout(),this.pushBuffer.push(n)),n}_onMessage(e,t,r){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,r){var n,i;const o=e.toLocaleLowerCase(),{close:a,error:l,leave:c,join:u}=F;if(r&&[a,l,c,u].indexOf(o)>=0&&r!==this._joinRef())return;let d=this._onMessage(o,t,r);if(t&&!d)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?(n=this.bindings.postgres_changes)===null||n===void 0||n.filter(f=>{var v,y,p;return((v=f.filter)===null||v===void 0?void 0:v.event)==="*"||((p=(y=f.filter)===null||y===void 0?void 0:y.event)===null||p===void 0?void 0:p.toLocaleLowerCase())===o}).map(f=>f.callback(d,r)):(i=this.bindings[o])===null||i===void 0||i.filter(f=>{var v,y,p,w,S,m;if(["broadcast","presence","postgres_changes"].includes(o))if("id"in f){const _=f.id,b=(v=f.filter)===null||v===void 0?void 0:v.event;return _&&((y=t.ids)===null||y===void 0?void 0:y.includes(_))&&(b==="*"||(b==null?void 0:b.toLocaleLowerCase())===((p=t.data)===null||p===void 0?void 0:p.type.toLocaleLowerCase()))}else{const _=(S=(w=f==null?void 0:f.filter)===null||w===void 0?void 0:w.event)===null||S===void 0?void 0:S.toLocaleLowerCase();return _==="*"||_===((m=t==null?void 0:t.event)===null||m===void 0?void 0:m.toLocaleLowerCase())}else return f.type.toLocaleLowerCase()===o}).map(f=>{if(typeof d=="object"&&"ids"in d){const v=d.data,{schema:y,table:p,commit_timestamp:w,type:S,errors:m}=v;d=Object.assign(Object.assign({},{schema:y,table:p,commit_timestamp:w,eventType:S,new:{},old:{},errors:m}),this._getPayloadRecords(v))}f.callback(d,r)})}_isClosed(){return this.state===L.closed}_isJoined(){return this.state===L.joined}_isJoining(){return this.state===L.joining}_isLeaving(){return this.state===L.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,r){const n=e.toLocaleLowerCase(),i={type:n,filter:t,callback:r};return this.bindings[n]?this.bindings[n].push(i):this.bindings[n]=[i],this}_off(e,t){const r=e.toLocaleLowerCase();return this.bindings[r]=this.bindings[r].filter(n=>{var i;return!(((i=n.type)===null||i===void 0?void 0:i.toLocaleLowerCase())===r&&bt.isEqual(n.filter,t))}),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const r in e)if(e[r]!==t[r])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(F.close,{},e)}_onError(e){this._on(F.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=L.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=Mt(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=Mt(e.columns,e.old_record)),t}}const Hs=()=>{},zs=typeof WebSocket<"u",Js=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class Ws{constructor(e,t){var r;this.accessTokenValue=null,this.apiKey=null,this.channels=[],this.endPoint="",this.httpEndpoint="",this.headers=Is,this.params={},this.timeout=$r,this.heartbeatIntervalMs=3e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=Hs,this.conn=null,this.sendBuffer=[],this.serializer=new Ls,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._resolveFetch=i=>{let o;return i?o=i:typeof fetch>"u"?o=(...a)=>ue(async()=>{const{default:l}=await Promise.resolve().then(()=>de);return{default:l}},void 0).then(({default:l})=>l(...a)):o=fetch,(...a)=>o(...a)},this.endPoint=`${e}/${ot.websocket}`,this.httpEndpoint=Cr(e),t!=null&&t.transport?this.transport=t.transport:this.transport=null,t!=null&&t.params&&(this.params=t.params),t!=null&&t.headers&&(this.headers=Object.assign(Object.assign({},this.headers),t.headers)),t!=null&&t.timeout&&(this.timeout=t.timeout),t!=null&&t.logger&&(this.logger=t.logger),t!=null&&t.heartbeatIntervalMs&&(this.heartbeatIntervalMs=t.heartbeatIntervalMs);const n=(r=t==null?void 0:t.params)===null||r===void 0?void 0:r.apikey;if(n&&(this.accessTokenValue=n,this.apiKey=n),this.reconnectAfterMs=t!=null&&t.reconnectAfterMs?t.reconnectAfterMs:i=>[1e3,2e3,5e3,1e4][i-1]||1e4,this.encode=t!=null&&t.encode?t.encode:(i,o)=>o(JSON.stringify(i)),this.decode=t!=null&&t.decode?t.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new xr(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(t==null?void 0:t.fetch),t!=null&&t.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.worker=(t==null?void 0:t.worker)||!1,this.workerUrl=t==null?void 0:t.workerUrl}this.accessToken=(t==null?void 0:t.accessToken)||null}connect(){if(!this.conn){if(this.transport){this.conn=new this.transport(this.endpointURL(),void 0,{headers:this.headers});return}if(zs){this.conn=new WebSocket(this.endpointURL()),this.setupConnection();return}this.conn=new Vs(this.endpointURL(),void 0,{close:()=>{this.conn=null}}),ue(async()=>{const{default:e}=await import("./browser-qbfAyGUc.js").then(t=>t.b);return{default:e}},[]).then(({default:e})=>{this.conn=new e(this.endpointURL(),void 0,{headers:this.headers}),this.setupConnection()})}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:Rs}))}disconnect(e,t){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,t??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset())}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.disconnect(),e}log(e,t,r){this.logger(e,t,r)}connectionState(){switch(this.conn&&this.conn.readyState){case le.connecting:return Z.Connecting;case le.open:return Z.Open;case le.closing:return Z.Closing;default:return Z.Closed}}isConnected(){return this.connectionState()===Z.Open}channel(e,t={config:{}}){const r=new bt(`realtime:${e}`,t,this);return this.channels.push(r),r}push(e){const{topic:t,event:r,payload:n,ref:i}=e,o=()=>{this.encode(e,a=>{var l;(l=this.conn)===null||l===void 0||l.send(a)})};this.log("push",`${t} ${r} (${i})`,n),this.isConnected()?o():this.sendBuffer.push(o)}async setAuth(e=null){let t=e||this.accessToken&&await this.accessToken()||this.accessTokenValue;if(t){let r=null;try{r=JSON.parse(atob(t.split(".")[1]))}catch{}if(r&&r.exp&&!(Math.floor(Date.now()/1e3)-r.exp<0))return this.log("auth",`InvalidJWTToken: Invalid value for JWT claim "exp" with value ${r.exp}`),Promise.reject(`InvalidJWTToken: Invalid value for JWT claim "exp" with value ${r.exp}`);this.accessTokenValue=t,this.channels.forEach(n=>{t&&n.updateJoinPayload({access_token:t}),n.joinedOnce&&n._isJoined()&&n._push(F.access_token,{access_token:t})})}}async sendHeartbeat(){var e;if(this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),(e=this.conn)===null||e===void 0||e.close(Ds,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.setAuth()}}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(r=>r.topic===e&&(r._isJoined()||r._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t._joinRef()!==e._joinRef())}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_onConnMessage(e){this.decode(e.data,t=>{let{topic:r,event:n,payload:i,ref:o}=t;o&&o===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null),this.log("receive",`${i.status||""} ${r} ${n} ${o&&"("+o+")"||""}`,i),this.channels.filter(a=>a._isMember(r)).forEach(a=>a._trigger(n,i,o)),this.stateChangeCallbacks.message.forEach(a=>a(t))})}async _onConnOpen(){if(this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this.reconnectTimer.reset(),!this.worker)this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs);else{this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}this.stateChangeCallbacks.open.forEach(e=>e())}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(t=>t(e))}_onConnError(e){this.log("transport",e.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(t=>t(e))}_triggerChanError(){this.channels.forEach(e=>e._trigger(F.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const r=e.match(/\?/)?"&":"?",n=new URLSearchParams(t);return`${e}${r}${n}`}_workerObjectUrl(e){let t;if(e)t=e;else{const r=new Blob([Js],{type:"application/javascript"});t=URL.createObjectURL(r)}return t}}class Vs{constructor(e,t,r){this.binaryType="arraybuffer",this.onclose=()=>{},this.onerror=()=>{},this.onmessage=()=>{},this.onopen=()=>{},this.readyState=le.connecting,this.send=()=>{},this.url=null,this.url=e,this.close=r.close}}class kt extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function C(s){return typeof s=="object"&&s!==null&&"__isStorageError"in s}class Ks extends kt{constructor(e,t){super(e),this.name="StorageApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class lt extends kt{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var Gs=function(s,e,t,r){function n(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(u){try{c(r.next(u))}catch(h){o(h)}}function l(u){try{c(r.throw(u))}catch(h){o(h)}}function c(u){u.done?i(u.value):n(u.value).then(a,l)}c((r=r.apply(s,e||[])).next())})};const jr=s=>{let e;return s?e=s:typeof fetch>"u"?e=(...t)=>ue(async()=>{const{default:r}=await Promise.resolve().then(()=>de);return{default:r}},void 0).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)},Ys=()=>Gs(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield ue(()=>Promise.resolve().then(()=>de),void 0)).Response:Response}),ct=s=>{if(Array.isArray(s))return s.map(t=>ct(t));if(typeof s=="function"||s!==Object(s))return s;const e={};return Object.entries(s).forEach(([t,r])=>{const n=t.replace(/([-_][a-z])/gi,i=>i.toUpperCase().replace(/[-_]/g,""));e[n]=ct(r)}),e};var te=function(s,e,t,r){function n(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(u){try{c(r.next(u))}catch(h){o(h)}}function l(u){try{c(r.throw(u))}catch(h){o(h)}}function c(u){u.done?i(u.value):n(u.value).then(a,l)}c((r=r.apply(s,e||[])).next())})};const Ke=s=>s.msg||s.message||s.error_description||s.error||JSON.stringify(s),Qs=(s,e,t)=>te(void 0,void 0,void 0,function*(){const r=yield Ys();s instanceof r&&!(t!=null&&t.noResolveJson)?s.json().then(n=>{e(new Ks(Ke(n),s.status||500))}).catch(n=>{e(new lt(Ke(n),n))}):e(new lt(Ke(s),s))}),Xs=(s,e,t,r)=>{const n={method:s,headers:(e==null?void 0:e.headers)||{}};return s==="GET"?n:(n.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),r&&(n.body=JSON.stringify(r)),Object.assign(Object.assign({},n),t))};function Pe(s,e,t,r,n,i){return te(this,void 0,void 0,function*(){return new Promise((o,a)=>{s(t,Xs(e,r,n,i)).then(l=>{if(!l.ok)throw l;return r!=null&&r.noResolveJson?l:l.json()}).then(l=>o(l)).catch(l=>Qs(l,a,r))})})}function Ue(s,e,t,r){return te(this,void 0,void 0,function*(){return Pe(s,"GET",e,t,r)})}function J(s,e,t,r,n){return te(this,void 0,void 0,function*(){return Pe(s,"POST",e,r,n,t)})}function Zs(s,e,t,r,n){return te(this,void 0,void 0,function*(){return Pe(s,"PUT",e,r,n,t)})}function en(s,e,t,r){return te(this,void 0,void 0,function*(){return Pe(s,"HEAD",e,Object.assign(Object.assign({},t),{noResolveJson:!0}),r)})}function Ir(s,e,t,r,n){return te(this,void 0,void 0,function*(){return Pe(s,"DELETE",e,r,n,t)})}var R=function(s,e,t,r){function n(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(u){try{c(r.next(u))}catch(h){o(h)}}function l(u){try{c(r.throw(u))}catch(h){o(h)}}function c(u){u.done?i(u.value):n(u.value).then(a,l)}c((r=r.apply(s,e||[])).next())})};const tn={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Ht={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class rn{constructor(e,t={},r,n){this.url=e,this.headers=t,this.bucketId=r,this.fetch=jr(n)}uploadOrUpdate(e,t,r,n){return R(this,void 0,void 0,function*(){try{let i;const o=Object.assign(Object.assign({},Ht),n);let a=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(o.upsert)});const l=o.metadata;typeof Blob<"u"&&r instanceof Blob?(i=new FormData,i.append("cacheControl",o.cacheControl),l&&i.append("metadata",this.encodeMetadata(l)),i.append("",r)):typeof FormData<"u"&&r instanceof FormData?(i=r,i.append("cacheControl",o.cacheControl),l&&i.append("metadata",this.encodeMetadata(l))):(i=r,a["cache-control"]=`max-age=${o.cacheControl}`,a["content-type"]=o.contentType,l&&(a["x-metadata"]=this.toBase64(this.encodeMetadata(l)))),n!=null&&n.headers&&(a=Object.assign(Object.assign({},a),n.headers));const c=this._removeEmptyFolders(t),u=this._getFinalPath(c),h=yield this.fetch(`${this.url}/object/${u}`,Object.assign({method:e,body:i,headers:a},o!=null&&o.duplex?{duplex:o.duplex}:{})),d=yield h.json();return h.ok?{data:{path:c,id:d.Id,fullPath:d.Key},error:null}:{data:null,error:d}}catch(i){if(C(i))return{data:null,error:i};throw i}})}upload(e,t,r){return R(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,r)})}uploadToSignedUrl(e,t,r,n){return R(this,void 0,void 0,function*(){const i=this._removeEmptyFolders(e),o=this._getFinalPath(i),a=new URL(this.url+`/object/upload/sign/${o}`);a.searchParams.set("token",t);try{let l;const c=Object.assign({upsert:Ht.upsert},n),u=Object.assign(Object.assign({},this.headers),{"x-upsert":String(c.upsert)});typeof Blob<"u"&&r instanceof Blob?(l=new FormData,l.append("cacheControl",c.cacheControl),l.append("",r)):typeof FormData<"u"&&r instanceof FormData?(l=r,l.append("cacheControl",c.cacheControl)):(l=r,u["cache-control"]=`max-age=${c.cacheControl}`,u["content-type"]=c.contentType);const h=yield this.fetch(a.toString(),{method:"PUT",body:l,headers:u}),d=yield h.json();return h.ok?{data:{path:i,fullPath:d.Key},error:null}:{data:null,error:d}}catch(l){if(C(l))return{data:null,error:l};throw l}})}createSignedUploadUrl(e,t){return R(this,void 0,void 0,function*(){try{let r=this._getFinalPath(e);const n=Object.assign({},this.headers);t!=null&&t.upsert&&(n["x-upsert"]="true");const i=yield J(this.fetch,`${this.url}/object/upload/sign/${r}`,{},{headers:n}),o=new URL(this.url+i.url),a=o.searchParams.get("token");if(!a)throw new kt("No token returned by API");return{data:{signedUrl:o.toString(),path:e,token:a},error:null}}catch(r){if(C(r))return{data:null,error:r};throw r}})}update(e,t,r){return R(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,r)})}move(e,t,r){return R(this,void 0,void 0,function*(){try{return{data:yield J(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:r==null?void 0:r.destinationBucket},{headers:this.headers}),error:null}}catch(n){if(C(n))return{data:null,error:n};throw n}})}copy(e,t,r){return R(this,void 0,void 0,function*(){try{return{data:{path:(yield J(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:r==null?void 0:r.destinationBucket},{headers:this.headers})).Key},error:null}}catch(n){if(C(n))return{data:null,error:n};throw n}})}createSignedUrl(e,t,r){return R(this,void 0,void 0,function*(){try{let n=this._getFinalPath(e),i=yield J(this.fetch,`${this.url}/object/sign/${n}`,Object.assign({expiresIn:t},r!=null&&r.transform?{transform:r.transform}:{}),{headers:this.headers});const o=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return i={signedUrl:encodeURI(`${this.url}${i.signedURL}${o}`)},{data:i,error:null}}catch(n){if(C(n))return{data:null,error:n};throw n}})}createSignedUrls(e,t,r){return R(this,void 0,void 0,function*(){try{const n=yield J(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),i=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return{data:n.map(o=>Object.assign(Object.assign({},o),{signedUrl:o.signedURL?encodeURI(`${this.url}${o.signedURL}${i}`):null})),error:null}}catch(n){if(C(n))return{data:null,error:n};throw n}})}download(e,t){return R(this,void 0,void 0,function*(){const n=typeof(t==null?void 0:t.transform)<"u"?"render/image/authenticated":"object",i=this.transformOptsToQueryString((t==null?void 0:t.transform)||{}),o=i?`?${i}`:"";try{const a=this._getFinalPath(e);return{data:yield(yield Ue(this.fetch,`${this.url}/${n}/${a}${o}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(a){if(C(a))return{data:null,error:a};throw a}})}info(e){return R(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const r=yield Ue(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:ct(r),error:null}}catch(r){if(C(r))return{data:null,error:r};throw r}})}exists(e){return R(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield en(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(r){if(C(r)&&r instanceof lt){const n=r.originalError;if([400,404].includes(n==null?void 0:n.status))return{data:!1,error:r}}throw r}})}getPublicUrl(e,t){const r=this._getFinalPath(e),n=[],i=t!=null&&t.download?`download=${t.download===!0?"":t.download}`:"";i!==""&&n.push(i);const a=typeof(t==null?void 0:t.transform)<"u"?"render/image":"object",l=this.transformOptsToQueryString((t==null?void 0:t.transform)||{});l!==""&&n.push(l);let c=n.join("&");return c!==""&&(c=`?${c}`),{data:{publicUrl:encodeURI(`${this.url}/${a}/public/${r}${c}`)}}}remove(e){return R(this,void 0,void 0,function*(){try{return{data:yield Ir(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(C(t))return{data:null,error:t};throw t}})}list(e,t,r){return R(this,void 0,void 0,function*(){try{const n=Object.assign(Object.assign(Object.assign({},tn),t),{prefix:e||""});return{data:yield J(this.fetch,`${this.url}/object/list/${this.bucketId}`,n,{headers:this.headers},r),error:null}}catch(n){if(C(n))return{data:null,error:n};throw n}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const sn="2.7.1",nn={"X-Client-Info":`storage-js/${sn}`};var ie=function(s,e,t,r){function n(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(u){try{c(r.next(u))}catch(h){o(h)}}function l(u){try{c(r.throw(u))}catch(h){o(h)}}function c(u){u.done?i(u.value):n(u.value).then(a,l)}c((r=r.apply(s,e||[])).next())})};class on{constructor(e,t={},r){this.url=e,this.headers=Object.assign(Object.assign({},nn),t),this.fetch=jr(r)}listBuckets(){return ie(this,void 0,void 0,function*(){try{return{data:yield Ue(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(C(e))return{data:null,error:e};throw e}})}getBucket(e){return ie(this,void 0,void 0,function*(){try{return{data:yield Ue(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(C(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return ie(this,void 0,void 0,function*(){try{return{data:yield J(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(C(r))return{data:null,error:r};throw r}})}updateBucket(e,t){return ie(this,void 0,void 0,function*(){try{return{data:yield Zs(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(C(r))return{data:null,error:r};throw r}})}emptyBucket(e){return ie(this,void 0,void 0,function*(){try{return{data:yield J(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(C(t))return{data:null,error:t};throw t}})}deleteBucket(e){return ie(this,void 0,void 0,function*(){try{return{data:yield Ir(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(C(t))return{data:null,error:t};throw t}})}}class an extends on{constructor(e,t={},r){super(e,t,r)}from(e){return new rn(this.url,this.headers,e,this.fetch)}}const ln="2.47.3";let ye="";typeof Deno<"u"?ye="deno":typeof document<"u"?ye="web":typeof navigator<"u"&&navigator.product==="ReactNative"?ye="react-native":ye="node";const cn={"X-Client-Info":`supabase-js-${ye}/${ln}`},un={headers:cn},hn={schema:"public"},dn={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},fn={};var _n=function(s,e,t,r){function n(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(u){try{c(r.next(u))}catch(h){o(h)}}function l(u){try{c(r.throw(u))}catch(h){o(h)}}function c(u){u.done?i(u.value):n(u.value).then(a,l)}c((r=r.apply(s,e||[])).next())})};const gn=s=>{let e;return s?e=s:typeof fetch>"u"?e=vr:e=fetch,(...t)=>e(...t)},pn=()=>typeof Headers>"u"?yr:Headers,vn=(s,e,t)=>{const r=gn(t),n=pn();return(i,o)=>_n(void 0,void 0,void 0,function*(){var a;const l=(a=yield e())!==null&&a!==void 0?a:s;let c=new n(o==null?void 0:o.headers);return c.has("apikey")||c.set("apikey",s),c.has("Authorization")||c.set("Authorization",`Bearer ${l}`),r(i,Object.assign(Object.assign({},o),{headers:c}))})};var yn=function(s,e,t,r){function n(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(u){try{c(r.next(u))}catch(h){o(h)}}function l(u){try{c(r.throw(u))}catch(h){o(h)}}function c(u){u.done?i(u.value):n(u.value).then(a,l)}c((r=r.apply(s,e||[])).next())})};function mn(s){return s.replace(/\/$/,"")}function wn(s,e){const{db:t,auth:r,realtime:n,global:i}=s,{db:o,auth:a,realtime:l,global:c}=e,u={db:Object.assign(Object.assign({},o),t),auth:Object.assign(Object.assign({},a),r),realtime:Object.assign(Object.assign({},l),n),global:Object.assign(Object.assign({},c),i),accessToken:()=>yn(this,void 0,void 0,function*(){return""})};return s.accessToken?u.accessToken=s.accessToken:delete u.accessToken,u}const Rr="2.66.1",bn="http://localhost:9999",kn="supabase.auth.token",Sn={"X-Client-Info":`gotrue-js/${Rr}`},zt=10,ut="X-Supabase-Api-Version",Dr={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}};function Tn(s){return Math.round(Date.now()/1e3)+s}function En(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(s){const e=Math.random()*16|0;return(s=="x"?e:e&3|8).toString(16)})}const M=()=>typeof document<"u",G={tested:!1,writable:!1},we=()=>{if(!M())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(G.tested)return G.writable;const s=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(s,s),globalThis.localStorage.removeItem(s),G.tested=!0,G.writable=!0}catch{G.tested=!0,G.writable=!1}return G.writable};function Ge(s){const e={},t=new URL(s);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((n,i)=>{e[i]=n})}catch{}return t.searchParams.forEach((r,n)=>{e[n]=r}),e}const Lr=s=>{let e;return s?e=s:typeof fetch>"u"?e=(...t)=>ue(async()=>{const{default:r}=await Promise.resolve().then(()=>de);return{default:r}},void 0).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)},Pn=s=>typeof s=="object"&&s!==null&&"status"in s&&"ok"in s&&"json"in s&&typeof s.json=="function",Ur=async(s,e,t)=>{await s.setItem(e,JSON.stringify(t))},$e=async(s,e)=>{const t=await s.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},xe=async(s,e)=>{await s.removeItem(e)};function On(s){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let t="",r,n,i,o,a,l,c,u=0;for(s=s.replace("-","+").replace("_","/");u<s.length;)o=e.indexOf(s.charAt(u++)),a=e.indexOf(s.charAt(u++)),l=e.indexOf(s.charAt(u++)),c=e.indexOf(s.charAt(u++)),r=o<<2|a>>4,n=(a&15)<<4|l>>2,i=(l&3)<<6|c,t=t+String.fromCharCode(r),l!=64&&n!=0&&(t=t+String.fromCharCode(n)),c!=64&&i!=0&&(t=t+String.fromCharCode(i));return t}class Je{constructor(){this.promise=new Je.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}Je.promiseConstructor=Promise;function Jt(s){const e=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}=?$|[a-z0-9_-]{2}(==)?$)$/i,t=s.split(".");if(t.length!==3)throw new Error("JWT is not valid: not a JWT structure");if(!e.test(t[1]))throw new Error("JWT is not valid: payload is not in base64url format");const r=t[1];return JSON.parse(On(r))}async function $n(s){return await new Promise(e=>{setTimeout(()=>e(null),s)})}function xn(s,e){return new Promise((r,n)=>{(async()=>{for(let i=0;i<1/0;i++)try{const o=await s(i);if(!e(i,null,o)){r(o);return}}catch(o){if(!e(i,o)){n(o);return}}})()})}function An(s){return("0"+s.toString(16)).substr(-2)}function Cn(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r=t.length;let n="";for(let i=0;i<56;i++)n+=t.charAt(Math.floor(Math.random()*r));return n}return crypto.getRandomValues(e),Array.from(e,An).join("")}async function jn(s){const t=new TextEncoder().encode(s),r=await crypto.subtle.digest("SHA-256",t),n=new Uint8Array(r);return Array.from(n).map(i=>String.fromCharCode(i)).join("")}function In(s){return btoa(s).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Rn(s){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),s;const t=await jn(s);return In(t)}async function oe(s,e,t=!1){const r=Cn();let n=r;t&&(n+="/PASSWORD_RECOVERY"),await Ur(s,`${e}-code-verifier`,n);const i=await Rn(r);return[i,r===i?"plain":"s256"]}const Dn=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function Ln(s){const e=s.headers.get(ut);if(!e||!e.match(Dn))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}class St extends Error{constructor(e,t,r){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=r}}function k(s){return typeof s=="object"&&s!==null&&"__isAuthError"in s}class Un extends St{constructor(e,t,r){super(e,t,r),this.name="AuthApiError",this.status=t,this.code=r}}function Nn(s){return k(s)&&s.name==="AuthApiError"}class Nr extends St{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class re extends St{constructor(e,t,r,n){super(e,r,n),this.name=t,this.status=r}}class H extends re{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function Mn(s){return k(s)&&s.name==="AuthSessionMissingError"}class Ye extends re{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Ae extends re{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class Ce extends re{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function Fn(s){return k(s)&&s.name==="AuthImplicitGrantRedirectError"}class Wt extends re{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class ht extends re{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function Qe(s){return k(s)&&s.name==="AuthRetryableFetchError"}class Vt extends re{constructor(e,t,r){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=r}}var Bn=function(s,e){var t={};for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&e.indexOf(r)<0&&(t[r]=s[r]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,r=Object.getOwnPropertySymbols(s);n<r.length;n++)e.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(s,r[n])&&(t[r[n]]=s[r[n]]);return t};const Q=s=>s.msg||s.message||s.error_description||s.error||JSON.stringify(s),qn=[502,503,504];async function Kt(s){var e;if(!Pn(s))throw new ht(Q(s),0);if(qn.includes(s.status))throw new ht(Q(s),s.status);let t;try{t=await s.json()}catch(i){throw new Nr(Q(i),i)}let r;const n=Ln(s);if(n&&n.getTime()>=Dr["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?r=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(r=t.error_code),r){if(r==="weak_password")throw new Vt(Q(t),s.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(r==="session_not_found")throw new H}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((i,o)=>i&&typeof o=="string",!0))throw new Vt(Q(t),s.status,t.weak_password.reasons);throw new Un(Q(t),s.status||500,r)}const Hn=(s,e,t,r)=>{const n={method:s,headers:(e==null?void 0:e.headers)||{}};return s==="GET"?n:(n.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),n.body=JSON.stringify(r),Object.assign(Object.assign({},n),t))};async function T(s,e,t,r){var n;const i=Object.assign({},r==null?void 0:r.headers);i[ut]||(i[ut]=Dr["2024-01-01"].name),r!=null&&r.jwt&&(i.Authorization=`Bearer ${r.jwt}`);const o=(n=r==null?void 0:r.query)!==null&&n!==void 0?n:{};r!=null&&r.redirectTo&&(o.redirect_to=r.redirectTo);const a=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",l=await zn(s,e,t+a,{headers:i,noResolveJson:r==null?void 0:r.noResolveJson},{},r==null?void 0:r.body);return r!=null&&r.xform?r==null?void 0:r.xform(l):{data:Object.assign({},l),error:null}}async function zn(s,e,t,r,n,i){const o=Hn(e,r,n,i);let a;try{a=await s(t,Object.assign({},o))}catch(l){throw console.error(l),new ht(Q(l),0)}if(a.ok||await Kt(a),r!=null&&r.noResolveJson)return a;try{return await a.json()}catch(l){await Kt(l)}}function z(s){var e;let t=null;Kn(s)&&(t=Object.assign({},s),s.expires_at||(t.expires_at=Tn(s.expires_in)));const r=(e=s.user)!==null&&e!==void 0?e:s;return{data:{session:t,user:r},error:null}}function Gt(s){const e=z(s);return!e.error&&s.weak_password&&typeof s.weak_password=="object"&&Array.isArray(s.weak_password.reasons)&&s.weak_password.reasons.length&&s.weak_password.message&&typeof s.weak_password.message=="string"&&s.weak_password.reasons.reduce((t,r)=>t&&typeof r=="string",!0)&&(e.data.weak_password=s.weak_password),e}function W(s){var e;return{data:{user:(e=s.user)!==null&&e!==void 0?e:s},error:null}}function Jn(s){return{data:s,error:null}}function Wn(s){const{action_link:e,email_otp:t,hashed_token:r,redirect_to:n,verification_type:i}=s,o=Bn(s,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),a={action_link:e,email_otp:t,hashed_token:r,redirect_to:n,verification_type:i},l=Object.assign({},o);return{data:{properties:a,user:l},error:null}}function Vn(s){return s}function Kn(s){return s.access_token&&s.refresh_token&&s.expires_in}var Gn=function(s,e){var t={};for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&e.indexOf(r)<0&&(t[r]=s[r]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,r=Object.getOwnPropertySymbols(s);n<r.length;n++)e.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(s,r[n])&&(t[r[n]]=s[r[n]]);return t};class Yn{constructor({url:e="",headers:t={},fetch:r}){this.url=e,this.headers=t,this.fetch=Lr(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t="global"){try{return await T(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(r){if(k(r))return{data:null,error:r};throw r}}async inviteUserByEmail(e,t={}){try{return await T(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:W})}catch(r){if(k(r))return{data:{user:null},error:r};throw r}}async generateLink(e){try{const{options:t}=e,r=Gn(e,["options"]),n=Object.assign(Object.assign({},r),t);return"newEmail"in r&&(n.new_email=r==null?void 0:r.newEmail,delete n.newEmail),await T(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:n,headers:this.headers,xform:Wn,redirectTo:t==null?void 0:t.redirectTo})}catch(t){if(k(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await T(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:W})}catch(t){if(k(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,r,n,i,o,a,l;try{const c={nextPage:null,lastPage:0,total:0},u=await T(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(t=e==null?void 0:e.page)===null||t===void 0?void 0:t.toString())!==null&&r!==void 0?r:"",per_page:(i=(n=e==null?void 0:e.perPage)===null||n===void 0?void 0:n.toString())!==null&&i!==void 0?i:""},xform:Vn});if(u.error)throw u.error;const h=await u.json(),d=(o=u.headers.get("x-total-count"))!==null&&o!==void 0?o:0,f=(l=(a=u.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&l!==void 0?l:[];return f.length>0&&(f.forEach(v=>{const y=parseInt(v.split(";")[0].split("=")[1].substring(0,1)),p=JSON.parse(v.split(";")[1].split("=")[1]);c[`${p}Page`]=y}),c.total=parseInt(d)),{data:Object.assign(Object.assign({},h),c),error:null}}catch(c){if(k(c))return{data:{users:[]},error:c};throw c}}async getUserById(e){try{return await T(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:W})}catch(t){if(k(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){try{return await T(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:W})}catch(r){if(k(r))return{data:{user:null},error:r};throw r}}async deleteUser(e,t=!1){try{return await T(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:W})}catch(r){if(k(r))return{data:{user:null},error:r};throw r}}async _listFactors(e){try{const{data:t,error:r}=await T(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:n=>({data:{factors:n},error:null})});return{data:t,error:r}}catch(t){if(k(t))return{data:null,error:t};throw t}}async _deleteFactor(e){try{return{data:await T(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(k(t))return{data:null,error:t};throw t}}}const Qn={getItem:s=>we()?globalThis.localStorage.getItem(s):null,setItem:(s,e)=>{we()&&globalThis.localStorage.setItem(s,e)},removeItem:s=>{we()&&globalThis.localStorage.removeItem(s)}};function Yt(s={}){return{getItem:e=>s[e]||null,setItem:(e,t)=>{s[e]=t},removeItem:e=>{delete s[e]}}}function Xn(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const ae={debug:!!(globalThis&&we()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class Mr extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class Zn extends Mr{}async function ei(s,e,t){ae.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",s,e);const r=new globalThis.AbortController;return e>0&&setTimeout(()=>{r.abort(),ae.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",s)},e),await globalThis.navigator.locks.request(s,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},async n=>{if(n){ae.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",s,n.name);try{return await t()}finally{ae.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",s,n.name)}}else{if(e===0)throw ae.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",s),new Zn(`Acquiring an exclusive Navigator LockManager lock "${s}" immediately failed`);if(ae.debug)try{const i=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(i,null,"  "))}catch(i){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",i)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}})}Xn();const ti={url:bn,storageKey:kn,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Sn,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1},pe=30*1e3,Qt=3;async function Xt(s,e,t){return await t()}class ke{constructor(e){var t,r;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=ke.nextInstanceID,ke.nextInstanceID+=1,this.instanceID>0&&M()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const n=Object.assign(Object.assign({},ti),e);if(this.logDebugMessages=!!n.debug,typeof n.debug=="function"&&(this.logger=n.debug),this.persistSession=n.persistSession,this.storageKey=n.storageKey,this.autoRefreshToken=n.autoRefreshToken,this.admin=new Yn({url:n.url,headers:n.headers,fetch:n.fetch}),this.url=n.url,this.headers=n.headers,this.fetch=Lr(n.fetch),this.lock=n.lock||Xt,this.detectSessionInUrl=n.detectSessionInUrl,this.flowType=n.flowType,this.hasCustomAuthorizationHeader=n.hasCustomAuthorizationHeader,n.lock?this.lock=n.lock:M()&&(!((t=globalThis==null?void 0:globalThis.navigator)===null||t===void 0)&&t.locks)?this.lock=ei:this.lock=Xt,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?n.storage?this.storage=n.storage:we()?this.storage=Qn:(this.memoryStorage={},this.storage=Yt(this.memoryStorage)):(this.memoryStorage={},this.storage=Yt(this.memoryStorage)),M()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(i){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",i)}(r=this.broadcastChannel)===null||r===void 0||r.addEventListener("message",async i=>{this._debug("received broadcast notification from other tab or client",i),await this._notifyAllSubscribers(i.data.event,i.data.session,!1)})}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${Rr}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{const t=M()?await this._isPKCEFlow():!1;if(this._debug("#_initialize()","begin","is PKCE flow",t),t||this.detectSessionInUrl&&this._isImplicitGrantFlow()){const{data:r,error:n}=await this._getSessionFromURL(t);if(n){if(this._debug("#_initialize()","error detecting session from URL",n),Fn(n)){const a=(e=n.details)===null||e===void 0?void 0:e.code;if(a==="identity_already_exists"||a==="identity_not_found"||a==="single_identity_not_deletable")return{error:n}}return await this._removeSession(),{error:n}}const{session:i,redirectType:o}=r;return this._debug("#_initialize()","detected session in URL",i,"redirect type",o),await this._saveSession(i),setTimeout(async()=>{o==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",i):await this._notifyAllSubscribers("SIGNED_IN",i)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return k(t)?{error:t}:{error:new Nr("Unexpected error during initialization",t)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,r,n;try{const i=await T(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(r=(t=e==null?void 0:e.options)===null||t===void 0?void 0:t.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:(n=e==null?void 0:e.options)===null||n===void 0?void 0:n.captchaToken}},xform:z}),{data:o,error:a}=i;if(a||!o)return{data:{user:null,session:null},error:a};const l=o.session,c=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:c,session:l},error:null}}catch(i){if(k(i))return{data:{user:null,session:null},error:i};throw i}}async signUp(e){var t,r,n;try{let i;if("email"in e){const{email:u,password:h,options:d}=e;let f=null,v=null;this.flowType==="pkce"&&([f,v]=await oe(this.storage,this.storageKey)),i=await T(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:d==null?void 0:d.emailRedirectTo,body:{email:u,password:h,data:(t=d==null?void 0:d.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:d==null?void 0:d.captchaToken},code_challenge:f,code_challenge_method:v},xform:z})}else if("phone"in e){const{phone:u,password:h,options:d}=e;i=await T(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:u,password:h,data:(r=d==null?void 0:d.data)!==null&&r!==void 0?r:{},channel:(n=d==null?void 0:d.channel)!==null&&n!==void 0?n:"sms",gotrue_meta_security:{captcha_token:d==null?void 0:d.captchaToken}},xform:z})}else throw new Ae("You must provide either an email or phone number and a password");const{data:o,error:a}=i;if(a||!o)return{data:{user:null,session:null},error:a};const l=o.session,c=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:c,session:l},error:null}}catch(i){if(k(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithPassword(e){try{let t;if("email"in e){const{email:i,password:o,options:a}=e;t=await T(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:i,password:o,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},xform:Gt})}else if("phone"in e){const{phone:i,password:o,options:a}=e;t=await T(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:i,password:o,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},xform:Gt})}else throw new Ae("You must provide either an email or phone number and a password");const{data:r,error:n}=t;return n?{data:{user:null,session:null},error:n}:!r||!r.session||!r.user?{data:{user:null,session:null},error:new Ye}:(r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:n})}catch(t){if(k(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,r,n,i;return await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(r=e.options)===null||r===void 0?void 0:r.scopes,queryParams:(n=e.options)===null||n===void 0?void 0:n.queryParams,skipBrowserRedirect:(i=e.options)===null||i===void 0?void 0:i.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async _exchangeCodeForSession(e){const t=await $e(this.storage,`${this.storageKey}-code-verifier`),[r,n]=(t??"").split("/");try{const{data:i,error:o}=await T(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:r},xform:z});if(await xe(this.storage,`${this.storageKey}-code-verifier`),o)throw o;return!i||!i.session||!i.user?{data:{user:null,session:null,redirectType:null},error:new Ye}:(i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",i.session)),{data:Object.assign(Object.assign({},i),{redirectType:n??null}),error:o})}catch(i){if(k(i))return{data:{user:null,session:null,redirectType:null},error:i};throw i}}async signInWithIdToken(e){try{const{options:t,provider:r,token:n,access_token:i,nonce:o}=e,a=await T(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:n,access_token:i,nonce:o,gotrue_meta_security:{captcha_token:t==null?void 0:t.captchaToken}},xform:z}),{data:l,error:c}=a;return c?{data:{user:null,session:null},error:c}:!l||!l.session||!l.user?{data:{user:null,session:null},error:new Ye}:(l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),{data:l,error:c})}catch(t){if(k(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,r,n,i,o;try{if("email"in e){const{email:a,options:l}=e;let c=null,u=null;this.flowType==="pkce"&&([c,u]=await oe(this.storage,this.storageKey));const{error:h}=await T(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:a,data:(t=l==null?void 0:l.data)!==null&&t!==void 0?t:{},create_user:(r=l==null?void 0:l.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken},code_challenge:c,code_challenge_method:u},redirectTo:l==null?void 0:l.emailRedirectTo});return{data:{user:null,session:null},error:h}}if("phone"in e){const{phone:a,options:l}=e,{data:c,error:u}=await T(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:a,data:(n=l==null?void 0:l.data)!==null&&n!==void 0?n:{},create_user:(i=l==null?void 0:l.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken},channel:(o=l==null?void 0:l.channel)!==null&&o!==void 0?o:"sms"}});return{data:{user:null,session:null,messageId:c==null?void 0:c.message_id},error:u}}throw new Ae("You must provide either an email or phone number.")}catch(a){if(k(a))return{data:{user:null,session:null},error:a};throw a}}async verifyOtp(e){var t,r;try{let n,i;"options"in e&&(n=(t=e.options)===null||t===void 0?void 0:t.redirectTo,i=(r=e.options)===null||r===void 0?void 0:r.captchaToken);const{data:o,error:a}=await T(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:i}}),redirectTo:n,xform:z});if(a)throw a;if(!o)throw new Error("An error occurred on token verification.");const l=o.session,c=o.user;return l!=null&&l.access_token&&(await this._saveSession(l),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",l)),{data:{user:c,session:l},error:null}}catch(n){if(k(n))return{data:{user:null,session:null},error:n};throw n}}async signInWithSSO(e){var t,r,n;try{let i=null,o=null;return this.flowType==="pkce"&&([i,o]=await oe(this.storage,this.storageKey)),await T(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(r=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&r!==void 0?r:void 0}),!((n=e==null?void 0:e.options)===null||n===void 0)&&n.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:i,code_challenge_method:o}),headers:this.headers,xform:Jn})}catch(i){if(k(i))return{data:null,error:i};throw i}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:r}=e;if(r)throw r;if(!t)throw new H;const{error:n}=await T(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:n}})}catch(e){if(k(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:r,type:n,options:i}=e,{error:o}=await T(this.fetch,"POST",t,{headers:this.headers,body:{email:r,type:n,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}},redirectTo:i==null?void 0:i.emailRedirectTo});return{data:{user:null,session:null},error:o}}else if("phone"in e){const{phone:r,type:n,options:i}=e,{data:o,error:a}=await T(this.fetch,"POST",t,{headers:this.headers,body:{phone:r,type:n,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}}});return{data:{user:null,session:null,messageId:o==null?void 0:o.message_id},error:a}}throw new Ae("You must provide either an email or phone number and a type")}catch(t){if(k(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const r=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),n=(async()=>(await r,await t()))();return this.pendingInLock.push((async()=>{try{await n}catch{}})()),n}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const r=t();for(this.pendingInLock.push((async()=>{try{await r}catch{}})()),await r;this.pendingInLock.length;){const n=[...this.pendingInLock];await Promise.all(n),this.pendingInLock.splice(0,n.length)}return await r}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await $e(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const r=e.expires_at?e.expires_at<=Date.now()/1e3:!1;if(this._debug("#__loadSession()",`session has${r?"":" not"} expired`,"expires_at",e.expires_at),!r){if(this.storage.isServer){let o=this.suppressGetSessionWarning;e=new Proxy(e,{get:(l,c,u)=>(!o&&c==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),o=!0,this.suppressGetSessionWarning=!0),Reflect.get(l,c,u))})}return{data:{session:e},error:null}}const{session:n,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{session:null},error:i}:{data:{session:n},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await T(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:W}):await this._useSession(async t=>{var r,n,i;const{data:o,error:a}=t;if(a)throw a;return!(!((r=o.session)===null||r===void 0)&&r.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new H}:await T(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(i=(n=o.session)===null||n===void 0?void 0:n.access_token)!==null&&i!==void 0?i:void 0,xform:W})})}catch(t){if(k(t))return Mn(t)&&(await this._removeSession(),await xe(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async r=>{const{data:n,error:i}=r;if(i)throw i;if(!n.session)throw new H;const o=n.session;let a=null,l=null;this.flowType==="pkce"&&e.email!=null&&([a,l]=await oe(this.storage,this.storageKey));const{data:c,error:u}=await T(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t==null?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:a,code_challenge_method:l}),jwt:o.access_token,xform:W});if(u)throw u;return o.user=c.user,await this._saveSession(o),await this._notifyAllSubscribers("USER_UPDATED",o),{data:{user:o.user},error:null}})}catch(r){if(k(r))return{data:{user:null},error:r};throw r}}_decodeJWT(e){return Jt(e)}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new H;const t=Date.now()/1e3;let r=t,n=!0,i=null;const o=Jt(e.access_token);if(o.exp&&(r=o.exp,n=r<=t),n){const{session:a,error:l}=await this._callRefreshToken(e.refresh_token);if(l)return{data:{user:null,session:null},error:l};if(!a)return{data:{user:null,session:null},error:null};i=a}else{const{data:a,error:l}=await this._getUser(e.access_token);if(l)throw l;i={access_token:e.access_token,refresh_token:e.refresh_token,user:a.user,token_type:"bearer",expires_in:r-t,expires_at:r},await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)}return{data:{user:i.user,session:i},error:null}}catch(t){if(k(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var r;if(!e){const{data:o,error:a}=t;if(a)throw a;e=(r=o.session)!==null&&r!==void 0?r:void 0}if(!(e!=null&&e.refresh_token))throw new H;const{session:n,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{user:null,session:null},error:i}:n?{data:{user:n.user,session:n},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(k(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e){try{if(!M())throw new Ce("No browser detected.");if(this.flowType==="implicit"&&!this._isImplicitGrantFlow())throw new Ce("Not a valid implicit grant flow url.");if(this.flowType=="pkce"&&!e)throw new Wt("Not a valid PKCE flow url.");const t=Ge(window.location.href);if(e){if(!t.code)throw new Wt("No code detected.");const{data:S,error:m}=await this._exchangeCodeForSession(t.code);if(m)throw m;const _=new URL(window.location.href);return _.searchParams.delete("code"),window.history.replaceState(window.history.state,"",_.toString()),{data:{session:S.session,redirectType:null},error:null}}if(t.error||t.error_description||t.error_code)throw new Ce(t.error_description||"Error in URL with unspecified error_description",{error:t.error||"unspecified_error",code:t.error_code||"unspecified_code"});const{provider_token:r,provider_refresh_token:n,access_token:i,refresh_token:o,expires_in:a,expires_at:l,token_type:c}=t;if(!i||!a||!o||!c)throw new Ce("No session defined in URL");const u=Math.round(Date.now()/1e3),h=parseInt(a);let d=u+h;l&&(d=parseInt(l));const f=d-u;f*1e3<=pe&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${f}s, should have been closer to ${h}s`);const v=d-h;u-v>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",v,d,u):u-v<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",v,d,u);const{data:y,error:p}=await this._getUser(i);if(p)throw p;const w={provider_token:r,provider_refresh_token:n,access_token:i,expires_in:h,expires_at:d,refresh_token:o,token_type:c,user:y.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:w,redirectType:t.type},error:null}}catch(t){if(k(t))return{data:{session:null,redirectType:null},error:t};throw t}}_isImplicitGrantFlow(){const e=Ge(window.location.href);return!!(M()&&(e.access_token||e.error_description))}async _isPKCEFlow(){const e=Ge(window.location.href),t=await $e(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var r;const{data:n,error:i}=t;if(i)return{error:i};const o=(r=n.session)===null||r===void 0?void 0:r.access_token;if(o){const{error:a}=await this.admin.signOut(o,e);if(a&&!(Nn(a)&&(a.status===404||a.status===401||a.status===403)))return{error:a}}return e!=="others"&&(await this._removeSession(),await xe(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const t=En(),r={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,r),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:r}}}async _emitInitialSession(e){return await this._useSession(async t=>{var r,n;try{const{data:{session:i},error:o}=t;if(o)throw o;await((r=this.stateChangeEmitters.get(e))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",i)),this._debug("INITIAL_SESSION","callback id",e,"session",i)}catch(i){await((n=this.stateChangeEmitters.get(e))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",i),console.error(i)}})}async resetPasswordForEmail(e,t={}){let r=null,n=null;this.flowType==="pkce"&&([r,n]=await oe(this.storage,this.storageKey,!0));try{return await T(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:r,code_challenge_method:n,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(i){if(k(i))return{data:null,error:i};throw i}}async getUserIdentities(){var e;try{const{data:t,error:r}=await this.getUser();if(r)throw r;return{data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(t){if(k(t))return{data:null,error:t};throw t}}async linkIdentity(e){var t;try{const{data:r,error:n}=await this._useSession(async i=>{var o,a,l,c,u;const{data:h,error:d}=i;if(d)throw d;const f=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(o=e.options)===null||o===void 0?void 0:o.redirectTo,scopes:(a=e.options)===null||a===void 0?void 0:a.scopes,queryParams:(l=e.options)===null||l===void 0?void 0:l.queryParams,skipBrowserRedirect:!0});return await T(this.fetch,"GET",f,{headers:this.headers,jwt:(u=(c=h.session)===null||c===void 0?void 0:c.access_token)!==null&&u!==void 0?u:void 0})});if(n)throw n;return M()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(r==null?void 0:r.url),{data:{provider:e.provider,url:r==null?void 0:r.url},error:null}}catch(r){if(k(r))return{data:{provider:e.provider,url:null},error:r};throw r}}async unlinkIdentity(e){try{return await this._useSession(async t=>{var r,n;const{data:i,error:o}=t;if(o)throw o;return await T(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(n=(r=i.session)===null||r===void 0?void 0:r.access_token)!==null&&n!==void 0?n:void 0})})}catch(t){if(k(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const r=Date.now();return await xn(async n=>(n>0&&await $n(200*Math.pow(2,n-1)),this._debug(t,"refreshing attempt",n),await T(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:z})),(n,i)=>{const o=200*Math.pow(2,n);return i&&Qe(i)&&Date.now()+o-r<pe})}catch(r){if(this._debug(t,"error",r),k(r))return{data:{session:null,user:null},error:r};throw r}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const r=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",r),M()&&!t.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}}async _recoverAndRefresh(){var e;const t="#_recoverAndRefresh()";this._debug(t,"begin");try{const r=await $e(this.storage,this.storageKey);if(this._debug(t,"session from storage",r),!this._isValidSession(r)){this._debug(t,"session is not valid"),r!==null&&await this._removeSession();return}const n=Math.round(Date.now()/1e3),i=((e=r.expires_at)!==null&&e!==void 0?e:1/0)<n+zt;if(this._debug(t,`session has${i?"":" not"} expired with margin of ${zt}s`),i){if(this.autoRefreshToken&&r.refresh_token){const{error:o}=await this._callRefreshToken(r.refresh_token);o&&(console.error(o),Qe(o)||(this._debug(t,"refresh failed with a non-retryable error, removing the session",o),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",r)}catch(r){this._debug(t,"error",r),console.error(r);return}finally{this._debug(t,"end")}}async _callRefreshToken(e){var t,r;if(!e)throw new H;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const n=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(n,"begin");try{this.refreshingDeferred=new Je;const{data:i,error:o}=await this._refreshAccessToken(e);if(o)throw o;if(!i.session)throw new H;await this._saveSession(i.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",i.session);const a={session:i.session,error:null};return this.refreshingDeferred.resolve(a),a}catch(i){if(this._debug(n,"error",i),k(i)){const o={session:null,error:i};return Qe(i)||await this._removeSession(),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(o),o}throw(r=this.refreshingDeferred)===null||r===void 0||r.reject(i),i}finally{this.refreshingDeferred=null,this._debug(n,"end")}}async _notifyAllSubscribers(e,t,r=!0){const n=`#_notifyAllSubscribers(${e})`;this._debug(n,"begin",t,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:t});const i=[],o=Array.from(this.stateChangeEmitters.values()).map(async a=>{try{await a.callback(e,t)}catch(l){i.push(l)}});if(await Promise.all(o),i.length>0){for(let a=0;a<i.length;a+=1)console.error(i[a]);throw i[0]}}finally{this._debug(n,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await Ur(this.storage,this.storageKey,e)}async _removeSession(){this._debug("#_removeSession()"),await xe(this.storage,this.storageKey),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&M()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),pe);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:r}}=t;if(!r||!r.refresh_token||!r.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const n=Math.floor((r.expires_at*1e3-e)/pe);this._debug("#_autoRefreshTokenTick()",`access token expires in ${n} ticks, a tick lasts ${pe}ms, refresh threshold is ${Qt} ticks`),n<=Qt&&await this._callRefreshToken(r.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof Mr)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!M()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,r){const n=[`provider=${encodeURIComponent(t)}`];if(r!=null&&r.redirectTo&&n.push(`redirect_to=${encodeURIComponent(r.redirectTo)}`),r!=null&&r.scopes&&n.push(`scopes=${encodeURIComponent(r.scopes)}`),this.flowType==="pkce"){const[i,o]=await oe(this.storage,this.storageKey),a=new URLSearchParams({code_challenge:`${encodeURIComponent(i)}`,code_challenge_method:`${encodeURIComponent(o)}`});n.push(a.toString())}if(r!=null&&r.queryParams){const i=new URLSearchParams(r.queryParams);n.push(i.toString())}return r!=null&&r.skipBrowserRedirect&&n.push(`skip_http_redirect=${r.skipBrowserRedirect}`),`${e}?${n.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var r;const{data:n,error:i}=t;return i?{data:null,error:i}:await T(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(r=n==null?void 0:n.session)===null||r===void 0?void 0:r.access_token})})}catch(t){if(k(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var r,n;const{data:i,error:o}=t;if(o)return{data:null,error:o};const a=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:l,error:c}=await T(this.fetch,"POST",`${this.url}/factors`,{body:a,headers:this.headers,jwt:(r=i==null?void 0:i.session)===null||r===void 0?void 0:r.access_token});return c?{data:null,error:c}:(e.factorType==="totp"&&(!((n=l==null?void 0:l.totp)===null||n===void 0)&&n.qr_code)&&(l.totp.qr_code=`data:image/svg+xml;utf-8,${l.totp.qr_code}`),{data:l,error:null})})}catch(t){if(k(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;const{data:n,error:i}=t;if(i)return{data:null,error:i};const{data:o,error:a}=await T(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(r=n==null?void 0:n.session)===null||r===void 0?void 0:r.access_token});return a?{data:null,error:a}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+o.expires_in},o)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",o),{data:o,error:a})})}catch(t){if(k(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;const{data:n,error:i}=t;return i?{data:null,error:i}:await T(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(r=n==null?void 0:n.session)===null||r===void 0?void 0:r.access_token})})}catch(t){if(k(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){const{data:t,error:r}=await this._challenge({factorId:e.factorId});return r?{data:null,error:r}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const r=(e==null?void 0:e.factors)||[],n=r.filter(o=>o.factor_type==="totp"&&o.status==="verified"),i=r.filter(o=>o.factor_type==="phone"&&o.status==="verified");return{data:{all:r,totp:n,phone:i},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,r;const{data:{session:n},error:i}=e;if(i)return{data:null,error:i};if(!n)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const o=this._decodeJWT(n.access_token);let a=null;o.aal&&(a=o.aal);let l=a;((r=(t=n.user.factors)===null||t===void 0?void 0:t.filter(h=>h.status==="verified"))!==null&&r!==void 0?r:[]).length>0&&(l="aal2");const u=o.amr||[];return{data:{currentLevel:a,nextLevel:l,currentAuthenticationMethods:u},error:null}}))}}ke.nextInstanceID=0;const ri=ke;class si extends ri{constructor(e){super(e)}}var ni=function(s,e,t,r){function n(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(u){try{c(r.next(u))}catch(h){o(h)}}function l(u){try{c(r.throw(u))}catch(h){o(h)}}function c(u){u.done?i(u.value):n(u.value).then(a,l)}c((r=r.apply(s,e||[])).next())})};class ii{constructor(e,t,r){var n,i,o;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const a=mn(e);this.realtimeUrl=`${a}/realtime/v1`.replace(/^http/i,"ws"),this.authUrl=`${a}/auth/v1`,this.storageUrl=`${a}/storage/v1`,this.functionsUrl=`${a}/functions/v1`;const l=`sb-${new URL(this.authUrl).hostname.split(".")[0]}-auth-token`,c={db:hn,realtime:fn,auth:Object.assign(Object.assign({},dn),{storageKey:l}),global:un},u=wn(r??{},c);this.storageKey=(n=u.auth.storageKey)!==null&&n!==void 0?n:"",this.headers=(i=u.global.headers)!==null&&i!==void 0?i:{},u.accessToken?(this.accessToken=u.accessToken,this.auth=new Proxy({},{get:(h,d)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(d)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((o=u.auth)!==null&&o!==void 0?o:{},this.headers,u.global.fetch),this.fetch=vn(t,this._getAccessToken.bind(this),u.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},u.realtime)),this.rest=new Cs(`${a}/rest/v1`,{headers:this.headers,schema:u.db.schema,fetch:this.fetch}),u.accessToken||this._listenForAuthEvents()}get functions(){return new os(this.functionsUrl,{headers:this.headers,customFetch:this.fetch})}get storage(){return new an(this.storageUrl,this.headers,this.fetch)}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},r={}){return this.rest.rpc(e,t,r)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return ni(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:r}=yield this.auth.getSession();return(t=(e=r.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:null})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:n,storageKey:i,flowType:o,lock:a,debug:l},c,u){var h;const d={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new si({url:this.authUrl,headers:Object.assign(Object.assign({},d),c),storageKey:i,autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:n,flowType:o,lock:a,debug:l,fetch:u,hasCustomAuthorizationHeader:(h="Authorization"in this.headers)!==null&&h!==void 0?h:!1})}_initRealtimeClient(e){return new Ws(this.realtimeUrl,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e==null?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,r)=>{this._handleTokenChanged(t,"CLIENT",r==null?void 0:r.access_token)})}_handleTokenChanged(e,t,r){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==r?this.changedAccessToken=r:e==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const oi=(s,e,t)=>new ii(s,e,t);function ai(){return typeof window>"u"?null:oi(void 0,void 0)}const I=ai(),li=({email:s})=>{const[e,t]=A(new Date),[r,n]=A(e.getFullYear().toString()),[i,o]=A({}),[a,l]=A(!0),c=["January","February","March","April","May","June","July","August","September","October","November","December"],u=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],h=async()=>{if(!s)return;console.log("Fetching monthly data..."),l(!0);const m=new Date(e.getFullYear(),e.getMonth(),1),_=new Date(e.getFullYear(),e.getMonth()+1,0);try{const{data:b,error:E}=await I.from("time_logs").select("date, total_seconds").eq("email",s).gte("date",m.toISOString().split("T")[0]).lte("date",_.toISOString().split("T")[0]);if(E)throw E;console.log("Received data:",b);const j={};b.forEach(B=>{j[B.date]=Math.round(B.total_seconds)}),console.log("Setting monthly data:",j),o(j)}catch(b){console.error("Error fetching monthly data:",b)}finally{l(!1)}};K(()=>{if(!s)return;console.log("Setting up realtime subscription for:",s),h();const m=I.channel("changes").on("postgres_changes",{event:"UPDATE",schema:"public",table:"time_logs"},_=>{console.log("Received UPDATE:",_),h()}).on("postgres_changes",{event:"INSERT",schema:"public",table:"time_logs"},_=>{console.log("Received INSERT:",_),h()}).subscribe(async(_,b)=>{b?console.error("Subscription error:",b):console.log("Subscription status:",_)});return()=>{console.log("Cleaning up subscription"),m.unsubscribe()}},[s]),K(()=>{h()},[e]);const d=()=>{t(m=>{const _=new Date(m.getFullYear(),m.getMonth()-1);return n(_.getFullYear().toString()),_})},f=()=>{t(m=>{const _=new Date(m.getFullYear(),m.getMonth()+1);return n(_.getFullYear().toString()),_})},v=m=>{t(new Date(e.getFullYear(),c.indexOf(m.target.value)))},y=m=>{const _=m.target.value;n(_),_.length===4&&!isNaN(_)&&t(new Date(parseInt(_),e.getMonth()))},p=m=>{if(!m)return null;const _=Math.floor(m/3600),b=Math.floor(m%3600/60);if(_>0){const E=b.toString().padStart(2,"0");return`${_}h ${E}m`}return`${b}m`},w=()=>{const m=new Date(e.getFullYear(),e.getMonth()+1,0).getDate(),_=new Date(e.getFullYear(),e.getMonth(),1).getDay(),b=[];for(let E=0;E<_;E++)b.push(g("div",{className:"h-24 border border-gray-200 dark:border-gray-700"},`empty-${E}`));for(let E=1;E<=m;E++){const j=new Date(e.getFullYear(),e.getMonth(),E),B=j.toISOString().split("T")[0],se=i[B],ne=new Date().toISOString().split("T")[0]===B,U=j.getDay()===0||j.getDay()===6;b.push(g("div",{className:`h-24 border border-gray-200 dark:border-gray-700 p-2 
            ${U?"bg-gray-50 dark:bg-slate-900/50":""} 
            ${ne?"ring-2 ring-blue-500":""}
            transition-colors`,children:g("div",{className:"flex flex-col h-full",children:[g("span",{className:`text-sm ${ne?"font-semibold":""} text-gray-800 dark:text-gray-200`,children:E}),se>0&&g("div",{className:"mt-auto",children:g("span",{className:"text-xs bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-100 px-2 py-1 rounded",children:p(se)})})]})},E))}return b},S=()=>{let m=0;return Object.values(i).forEach(_=>{_&&(m+=_)}),m===0?null:g("div",{className:"min-h-[1.5rem] text-sm text-gray-600 dark:text-gray-300 mb-2",children:["Monthly total: ",p(m)]})};return g("div",{className:"max-w-4xl mx-auto bg-white dark:bg-gray-800 rounded-lg shadow p-4 transition-colors",children:[g("div",{className:"flex items-center justify-between mb-4",children:[g("button",{onClick:d,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full text-gray-800 dark:text-gray-200",children:""}),g("div",{className:"flex items-center space-x-2",children:[g("select",{value:c[e.getMonth()],onChange:v,className:"border dark:border-gray-600 rounded px-2 py-1 bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200",children:c.map(m=>g("option",{value:m,children:m},m))}),g("input",{type:"text",value:r,onChange:y,className:"border dark:border-gray-600 rounded px-2 py-1 w-20 text-center bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200",maxLength:"4"})]}),g("button",{onClick:f,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full text-gray-800 dark:text-gray-200",children:""})]}),S(),g("div",{className:"grid grid-cols-7 gap-1 mb-1",children:u.map(m=>g("div",{className:"text-center font-medium py-1 text-gray-800 dark:text-gray-200",children:m},m))}),g("div",{className:"grid grid-cols-7 gap-1",children:w()})]})};async function Xe(s,e){if(!s||e<=0)return;const t=new Date().toISOString().split("T")[0];console.log(`Updating time log: ${e} seconds for ${s} on ${t}`);try{const{data:r}=await I.from("time_logs").select("total_seconds").eq("email",s).eq("date",t).single();if(r){const{data:n,error:i}=await I.from("time_logs").update({total_seconds:r.total_seconds+e,last_updated:new Date().toISOString()}).eq("email",s).eq("date",t).select();if(i)throw i;return console.log("Updated existing record:",n),n}else{const{data:n,error:i}=await I.from("time_logs").insert([{email:s,date:t,total_seconds:e}]).select();if(i)throw i;return console.log("Created new record:",n),n}}catch(r){throw console.error("Error updating time log:",r),r}}const Ze=[{title:"LN+ EN VIVO | ltimas noticias de Argentina y el mundo",videoId:"G5pHuBCqgrs"},{title:"TN EN VIVO I SEGU LA TRANSMISIN EN VIVO DE TODO NOTICIAS",videoId:"cb12KmMMDJA"},{title:"EN VIVO: Univision Noticias 24/7",videoId:"V4C7VNfRATA"},{title:" DW Espaol | En vivo",videoId:"Io5mt83nCcU"},{title:"euronews en directo",videoId:"O9mOtdZ-nSk"},{title:"FRANCE 24 Espaol  EN VIVO",videoId:"Y-IlMeCCtIg"}],ci=({email:s})=>{const[e,t]=A(!1),[r,n]=A(!1),[i,o]=A(0),[a,l]=A(null),[c,u]=A(Ze[0]),h=Dt(null),d=Dt(0);K(()=>{(async()=>{const b=new Date().toISOString().split("T")[0],{data:E,error:j}=await I.from("time_logs").select("total_seconds").eq("email",s).eq("date",b).single();E&&(o(E.total_seconds),d.current=E.total_seconds)})()},[s]),K(()=>{const _=document.createElement("script");_.src="https://www.youtube.com/iframe_api";const b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(_,b),window.onYouTubeIframeAPIReady=()=>{f(c.videoId)}},[]);const f=_=>{h.current=new window.YT.Player("youtube-player",{videoId:_,events:{onStateChange:v},playerVars:{playsinline:1,modestbranding:1,controls:0}})},v=_=>{if(_.data===1)n(!1),p(),t(!0);else if(_.data===2){n(!1),t(!1);const b=i-d.current;b>0&&Xe(s,b).then(()=>{d.current=i}).catch(console.error),w()}else _.data===3?(n(!0),w()):n(!1)},y=_=>{const b=Ze.find(j=>j.videoId===_.target.value);u(b),n(!0),t(!1);const E=i-d.current;E>0&&Xe(s,E).then(()=>{d.current=i}).catch(console.error),w(),h.current&&h.current.loadVideoById({videoId:b.videoId})},p=()=>{a&&clearInterval(a);const _=window.setInterval(()=>{o(b=>{const E=b+1;return E%15===0&&(console.log(`15-second boundary hit at ${E} seconds`),Xe(s,15).then(()=>{d.current=E}).catch(console.error)),E})},1e3);l(_)},w=()=>{a&&(window.clearInterval(a),l(null))},S=()=>{h.current&&(e?(h.current.pauseVideo(),t(!1),w()):h.current.playVideo())},m=_=>{const b=Math.floor(_/3600),E=Math.floor(_%3600/60),j=_%60;return`${b.toString().padStart(2,"0")}:${E.toString().padStart(2,"0")}:${j.toString().padStart(2,"0")}`};return K(()=>()=>{a&&clearInterval(a)},[a]),g("div",{className:"max-w-2xl mx-auto p-4",children:g("div",{className:"bg-gray-100 dark:bg-gray-800 rounded-lg shadow-md p-4 transition-colors",children:[g("div",{className:"mb-4",children:g("select",{value:c.videoId,onChange:y,className:"w-full p-2 border dark:border-gray-600 rounded bg-white dark:bg-gray-700 shadow-sm text-gray-800 dark:text-gray-200",children:Ze.map(_=>g("option",{value:_.videoId,children:_.title},_.videoId))})}),g("div",{className:"hidden",children:g("div",{id:"youtube-player"})}),g("div",{className:"flex items-center justify-between bg-white dark:bg-gray-700 p-4 rounded-lg",children:[g("button",{onClick:S,disabled:r,className:"text-5xl w-20 h-20 flex items-center justify-center hover:bg-gray-100 dark:hover:bg-gray-600 rounded-full transition-colors relative","aria-label":e?"Pause":"Play",children:r?g("div",{className:"w-12 h-12 rounded-full border-4 border-gray-200 dark:border-gray-600 border-t-blue-500 animate-spin"}):e?"":""}),g("div",{className:"flex flex-col items-end",children:[g("div",{className:"text-3xl font-mono text-gray-800 dark:text-gray-200",children:m(i)}),g("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Today's total"})]})]})]})})},ui=({onSignIn:s})=>{const[e,t]=A(""),[r,n]=A(!1),[i,o]=A(""),[a,l]=A(""),[c,u]=A(!1),[h,d]=A("");return g("div",{className:"flex min-h-screen items-center justify-center bg-gray-50 px-4",children:g("div",{className:"w-full max-w-md space-y-8",children:[g("div",{className:"text-center",children:[g("h1",{className:"text-6xl mb-8 font-bold",children:"Krashen Tracker"}),g("h2",{className:"text-2xl font-bold",children:"Sign in to your account"}),g("p",{className:"mt-2 text-gray-600",children:c?"Enter the code we sent to your email":"We'll send you a verification code"})]}),c?g("form",{onSubmit:async y=>{y.preventDefault(),n(!0),l(""),o("");try{const{error:p}=await I.auth.verifyOtp({email:e,token:h,type:"email"});if(p)throw p;o("Successfully logged in!")}catch(p){l(p.message)}finally{n(!1)}},className:"mt-8 space-y-6",children:[g("div",{children:[g("label",{htmlFor:"otp",className:"sr-only",children:"Verification Code"}),g("input",{id:"otp",type:"text",required:!0,value:h,onChange:y=>d(y.target.value),className:"w-full rounded-lg border border-gray-300 px-4 py-3 placeholder-gray-500 text-center tracking-widest",placeholder:"Enter 6-digit code",maxLength:"6",pattern:"\\d{6}",disabled:r})]}),a&&g("div",{className:"rounded-md bg-red-50 p-4 text-sm text-red-700",children:a}),i&&g("div",{className:"rounded-md bg-green-50 p-4 text-sm text-green-700",children:i}),g("div",{className:"space-y-4",children:[g("button",{type:"submit",disabled:r,className:"w-full rounded-lg bg-blue-600 px-4 py-3 text-white hover:bg-blue-700 disabled:opacity-50",children:r?"Verifying...":"Verify code"}),g("button",{type:"button",onClick:()=>{u(!1),d(""),l(""),o("")},className:"w-full text-sm text-gray-600 hover:text-gray-900",children:"Use a different email"})]})]}):g("form",{onSubmit:async y=>{y.preventDefault(),n(!0),l(""),o("");try{const{error:p}=await I.auth.signInWithOtp({email:e,options:{shouldCreateUser:!0}});if(p)throw p;u(!0),o("Check your email for the login code!")}catch(p){l(p.message)}finally{n(!1)}},className:"mt-8 space-y-6",children:[g("div",{children:[g("label",{htmlFor:"email",className:"sr-only",children:"Email address"}),g("input",{id:"email",type:"email",required:!0,value:e,onChange:y=>t(y.target.value),className:"w-full rounded-lg border border-gray-300 px-4 py-3 placeholder-gray-500",placeholder:"Enter your email",disabled:r})]}),a&&g("div",{className:"rounded-md bg-red-50 p-4 text-sm text-red-700",children:a}),i&&g("div",{className:"rounded-md bg-green-50 p-4 text-sm text-green-700",children:i}),g("button",{type:"submit",disabled:r,className:"w-full rounded-lg bg-blue-600 px-4 py-3 text-white hover:bg-blue-700 disabled:opacity-50",children:r?"Sending code...":"Send verification code"})]})]})})},Fr=vt();function hi({children:s}){const[e,t]=A(!1),[r,n]=A(!0);K(()=>{if(typeof window>"u")return;(async()=>{var l,c,u;const a=await I.auth.getSession();if((u=(c=(l=a==null?void 0:a.data)==null?void 0:l.session)==null?void 0:c.user)!=null&&u.email){const{data:h,error:d}=await I.from("users").select("dark_mode").eq("email",a.data.session.user.email).single();!d&&h&&t(h.dark_mode)}n(!1)})()},[]);const i=async()=>{var a,l,c;const o=await I.auth.getSession();if((c=(l=(a=o==null?void 0:o.data)==null?void 0:a.session)==null?void 0:l.user)!=null&&c.email){const u=!e,{error:h}=await I.from("users").update({dark_mode:u}).eq("email",o.data.session.user.email);h||t(u)}};return K(()=>{e?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")},[e]),g(Fr.Provider,{value:{darkMode:e,toggleDarkMode:i,loading:r},children:s})}function di(){const s=Yr(Fr);if(s===void 0)throw new Error("useDarkMode must be used within a DarkModeProvider");return s}function fi(){const{darkMode:s,toggleDarkMode:e}=di();return g("button",{onClick:e,className:"px-3 py-1 rounded bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors","aria-label":s?"Switch to light mode":"Switch to dark mode",children:s?"":""})}function _i(){const[s,e]=A(null),[t,r]=A(!0);return K(()=>{I.auth.getSession().then(({data:{session:i}})=>{e(i),r(!1)});const{data:{subscription:n}}=I.auth.onAuthStateChange((i,o)=>{e(o)});return()=>n.unsubscribe()},[]),t?g("div",{className:"w-full min-h-screen flex items-center justify-center bg-white dark:bg-gray-900",children:g("div",{className:"text-xl dark:text-white",children:"Loading..."})}):s?g("div",{className:"w-full min-h-screen bg-gray-50 dark:bg-gray-900 transition-colors",children:[g("div",{className:"fixed top-4 right-4 flex items-center gap-4 bg-white dark:bg-gray-800 p-2 rounded shadow-sm",children:[g("span",{className:"text-sm text-gray-800 dark:text-gray-200",children:s.user.email}),g(fi,{}),g("button",{onClick:()=>I.auth.signOut(),className:"rounded bg-gray-200 dark:bg-gray-700 px-3 py-1 text-sm hover:bg-gray-300 dark:hover:bg-gray-600 text-gray-800 dark:text-gray-200",children:"Sign out"})]}),g("div",{className:"w-full container mx-auto px-4 py-8 space-y-8",children:[g(ci,{email:s.user.email}),g(li,{email:s.user.email})]})]}):g(ui,{})}function gi(){return g(hi,{children:g(_i,{})})}typeof window<"u"&&es(g(gi,{}),document.getElementById("app"));export{pi as g};
